<!DOCTYPE html>
<html lang="ja"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ç©ã¿æœ¨è¨˜éŒ²è¡¨</title>

<!-- PWAå¯¾å¿œï¼šã‚¢ã‚¤ã‚³ãƒ³è¨­å®š -->
<link rel="icon" type="image/png" sizes="32x32" href="tumiki-icon.png">
<link rel="icon" type="image/png" sizes="16x16" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="152x152" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="144x144" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="120x120" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="114x114" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="76x76" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="72x72" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="60x60" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="57x57" href="tumiki-icon.png">
<link rel="apple-touch-icon" href="tumiki-icon.png">

<!-- PWAãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ -->
<link rel="manifest" href="manifest.json">

<!-- iOSç”¨ãƒ¡ã‚¿ã‚¿ã‚° -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="ç©ã¿æœ¨">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#ffffff">

<link rel="stylesheet" href="style.css">
<style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background-color: #f3f4f6;
        }
        
        /* 720x1280ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³æœ€é©åŒ– */
        .smartphone-container {
            width: 100%;
            margin: 0 auto;
            padding: 1px;
            box-sizing: border-box;
        }
        
        .form-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 16px;
            border: 1px solid #e5e7eb;
            width: 100%;
            min-width: 350px;
        }
        
        /* ã‚¿ã‚¤ãƒˆãƒ« */
        .title-box {
            border: 2px solid #9ca3af;
            padding: 12px;
            text-align: center;
            margin-bottom: 16px;
            border-radius: 6px;
        }
        
        .title-text {
            font-size: 20px;
            font-weight: bold;
            letter-spacing: 0.1em;
            color: #1f2937;
        }
        
        /* æ—¥ä»˜å…¥åŠ›ã‚¨ãƒªã‚¢ */
        .date-container {
            display: grid;
            grid-template-columns: 1.4fr auto 1fr auto 1fr auto;
            gap: 8px;
            align-items: center;
            margin-bottom: 16px;
            padding: 16px 12px;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            min-width: 320px;
        }
        
        .date-input {
            width: 100%;
            height: 48px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-bottom: 3px solid #9ca3af;
            background: transparent;
            outline: none;
            transition: border-color 0.2s;
            min-width: 0;
        }
        
        .date-input:focus {
            border-bottom-color: #3b82f6;
        }
        
        .date-label {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
        }
        
        /* æ™‚é–“å…¥åŠ›ã‚¨ãƒªã‚¢ */
        .time-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 16px;
            align-items: center;
            margin-bottom: 16px;
            padding: 16px 12px;
            background: #f0f9ff;
            border-radius: 8px;
            border: 1px solid #0ea5e9;
            min-width: 280px;
        }
        
        .time-input {
            width: 100%;
            height: 48px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-bottom: 3px solid #0ea5e9;
            background: transparent;
            outline: none;
            transition: border-color 0.2s;
            min-width: 0;
        }
        
        .time-input:focus {
            border-bottom-color: #0284c7;
        }
        
        .time-separator {
            font-size: 24px;
            font-weight: bold;
            color: #0ea5e9;
        }
        
        /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å…±é€š */
        .input-row {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 320px;
        }
        
        .input-label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            background: #e5e7eb;
            padding: 12px 16px;
            border: 1px solid #9ca3af;
            border-radius: 6px;
            min-width: 80px;
            text-align: center;
            white-space: nowrap;
        }
        
        .input-field {
            flex: 1;
            height: 48px;
            padding: 0 16px;
            font-size: 16px;
            border: none;
            border-bottom: 3px solid #9ca3af;
            background: transparent;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .input-field:focus {
            border-bottom-color: #3b82f6;
        }
        
        /* ç¢ºèªæ¬„ */
        .confirmation-box {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }
        
        .confirmation-title {
            font-size: 12px;
            font-weight: bold;
            color: #92400e;
            margin-bottom: 5px;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-input {
            width: 20px;
            height: 20px;
            accent-color: #3b82f6;
        }
        
        .checkbox-label {
            font-size: 14px;
            font-weight: 600;
            color: #92400e;
        }
        
        .warning-text {
            color: #dc2626;
            font-size: 12px;
            margin-top: 6px;
        }
        
        /* é€ä¿¡ãƒœã‚¿ãƒ³ */
        .submit-button {
            width: 100%;
            height: 56px;
            background: #3b82f6;
            color: white;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            margin-top: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .submit-button:hover {
            background: #2563eb;
        }
        
        .submit-button:active {
            transform: translateY(1px);
        }
        
        /* ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
        .admin-menu {
            text-align: right;
            margin-bottom: 16px;
        }
        
        .admin-button {
            background: #10b981;
            color: white;
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            border: none;
            cursor: pointer;
        }
        
        .admin-button:hover {
            background: #059669;
        }
        
        /* çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .result-area {
            margin-top: 16px;
            padding: 16px;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .result-area.hidden {
            display: none;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ */
        @media (max-width: 480px) {
            .smartphone-container {
                padding: 4px;
            }
            
            .form-container {
                padding: 12px;
            }
            
            .date-container {
                grid-template-columns: 1.2fr auto 0.8fr auto 0.8fr auto;
                gap: 6px;
                padding: 12px 8px;
            }
            
            .time-container {
                grid-template-columns: 1fr auto 1fr;
                gap: 12px;
                padding: 12px 8px;
            }
            
            .input-row {
                flex-direction: row;
                align-items: center;
                gap: 8px;
            }
            
            .input-label {
                min-width: 70px;
                text-align: center;
                font-size: 14px;
                padding: 10px 12px;
            }
            
            .input-field {
                height: 48px;
                font-size: 16px;
            }
            
            .date-input, .time-input {
                height: 48px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="smartphone-container">
        <div class="form-container">
            <div id="admin-menu" class="admin-menu"></div>
            
            <form id="recordForm" method="POST">
                <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
                <div class="title-box">
                    <h1 class="title-text">ç©ã¿æœ¨è¨˜éŒ²è¡¨</h1>
                </div>

                <!-- æ—¥ä»˜å…¥åŠ› -->
                <div class="date-container">
                    <input list="years" id="year" name="year" class="date-input" placeholder="2024" required>
                    <datalist id="years"></datalist>
                    <span class="date-label">å¹´</span>

                    <input list="months" id="month" name="month" class="date-input" placeholder="7" required>
                    <datalist id="months"></datalist>
                    <span class="date-label">æœˆ</span>

                    <input list="days" id="day" name="day" class="date-input" placeholder="20" required>
                    <datalist id="days"></datalist>
                    <span class="date-label">æ—¥</span>
                </div>

                <!-- æ™‚é–“å…¥åŠ› -->
                <div class="time-container">
                    <input id="start-time" name="startTime" class="time-input" placeholder="9:00" required>
                    <span class="time-separator">~</span>
                    <input id="end-time" name="endTime" class="time-input" placeholder="12:00" required>
                </div>

                <!-- æ”¯æ´å“¡1 -->
                <div class="input-row">
                    <label class="input-label" for="supporter1-input">æ”¯æ´å“¡1</label>
                    <input list="supporters" id="supporter1-input" name="supporter1" class="input-field" required>
                    <datalist id="supporters">
                        <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                    </datalist>
                </div>

                <!-- æ”¯æ´å“¡2 -->
                <div class="input-row">
                    <label class="input-label" for="supporter2-input">æ”¯æ´å“¡2</label>
                    <input list="supporters" id="supporter2-input" name="supporter2" class="input-field">
                </div>

                <!-- æ”¯æ´ç¨®åˆ¥ -->
                <div class="input-row">
                    <label class="input-label" for="support-type-input">æ”¯æ´ç¨®åˆ¥</label>
                    <input list="support-types" id="support-type-input" name="supportType" class="input-field" required>
                    <datalist id="support-types">
                        <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                    </datalist>
                </div>

                <!-- åˆ©ç”¨è€… -->
                <div class="input-row">
                    <label class="input-label" for="user-input">åˆ©ç”¨è€…</label>
                    <input list="users" id="user-input" name="user" class="input-field" required>
                    <datalist id="users">
                        <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                    </datalist>
                </div>

                <!-- è¡Œãå…ˆ -->
                <div class="input-row">
                    <label class="input-label" for="destination-input">è¡Œãå…ˆ</label>
                    <input list="destinations" id="destination-input" name="destination" class="input-field" required>
                    <datalist id="destinations">
                        <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                    </datalist>
                </div>

                <!-- åˆ©ç”¨è€…æ§˜ç¢ºèªæ¬„ -->
                <div class="confirmation-box">
                    <p class="confirmation-title">åˆ©ç”¨è€…æ§˜ç¢ºèªæ¬„</p>
                    <div class="checkbox-container">
                        <input type="checkbox" id="check1" name="userCheck" class="checkbox-input" required>
                        <label for="check1" class="checkbox-label">ä¸Šè¨˜å†…å®¹ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚</label>
                    </div>
                    <p class="warning-text">â€»åˆ©ç”¨è€…æ§˜ã«ãƒã‚§ãƒƒã‚¯ã‚’ã‚‚ã‚‰ã£ã¦ãã ã•ã„ã€‚</p>
                </div>
                
                <!-- æ§˜å­ -->
                <div class="input-row">
                    <label class="input-label" for="appearance-input">æ§˜å­</label>
                    <input list="appearances" id="appearance-input" name="appearance" class="input-field" required>
                    <datalist id="appearances">
                        <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                    </datalist>
                </div>

                <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
                <button type="submit" class="submit-button">è¨˜éŒ²ã‚’é€ä¿¡</button>
                
                <!-- é€ä¿¡çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div id="submissionResult" class="result-area hidden">
                    <p id="resultMessage"></p>
                </div>
            </form>
        </div>
    </div>

    <script>
        console.log("Script loaded and running");

        let supporterSupportTypesMap = {};
        let userRemainingTimesMap = {};
        let allUsers = [];
        let currentSupportType = ''; // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹æ”¯æ´ç¨®åˆ¥ã‚’ä¿æŒ



        // datalist ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        function updateDatalist(datalistId, items) {
            console.log(`ğŸ“ ${datalistId} ã‚’æ›´æ–°ä¸­... ã‚¢ã‚¤ãƒ†ãƒ æ•°: ${items.length}`);
            const datalist = document.getElementById(datalistId);
            
            if (!datalist) {
                console.error(`âŒ datalist ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${datalistId}`);
                return;
            }
            
            // æ—¢å­˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
            datalist.innerHTML = '';
            console.log(`ğŸ—‘ï¸ ${datalistId} ã®æ—¢å­˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ`);
            
            // "-" ã‚„ç©ºç™½ã€nullã€undefinedã‚’é™¤å¤–ã—ã¦è¿½åŠ 
            const filteredItems = items.filter(item =>
                item && item.toString().trim() !== '' && item.toString().trim() !== '-'
            );
            
            filteredItems.forEach((item, index) => {
                const option = document.createElement('option');
                option.value = item;
                datalist.appendChild(option);
                if (index < 3) { // æœ€åˆã®3ã¤ã ã‘ãƒ­ã‚°å‡ºåŠ›
                    console.log(`â• ${datalistId}[${index}]: ${item}`);
                }
            });
            
            console.log(`âœ… ${datalistId} ã®æ›´æ–°å®Œäº†ï¼ˆ${filteredItems.length}å€‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€${items.length - filteredItems.length}å€‹é™¤å¤–ï¼‰`);
        }

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰
        function loadDefaultData() {
            console.log("ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¾ã™");
            
            const defaultUsers = [
                "å¹³æ—æµå­", "ç©ºå±±ç´˜å­", "å±±ï¨‘å¤šæµ", "æ°´è°·å¤•ç¾å­", "å¡šåŸæ­©ç¾", "ä¸Šæ‘æ¢¨æ¡œ", 
                "å²©æœ¬å°è€¶å­", "æ¾¤æ‘å’Œæµ©", "å»£ç€¬ä¹…ç”·", "æ¸…æ°´å¥å¸", "ç”°ä¸­çœŸä¹Ÿ", "ä¸­è¥¿ä¿Šä¹Ÿ", 
                "æ£®æœ¬å¾¹", "å°æ³‰æ˜¥å¤«", "é•·é‡å´‡", "å‹ç”°é™½å­", "ä»Šäº•æµ©", "å‡ºæˆ¸å¸‚æœ—", 
                "å²¡ç”°æµ©å—£", "ä¸Šæ—èª ", "æºå·æ™§ä»‹", "ä¹…å±±å¤§", "æ¸¡é‚‰ä¸€å­", "å¡©è°·æ‹“ä¹Ÿ", 
                "è—¤æœ¬å’Œä¹Ÿ", "ä¸Šç”°æ²»", "ä»²è¥¿ç¾ç”±ç´€", "ç”°ä¸Šæ…¶ç¥", "æ¦æœ¬è‰¯å…", "åƒè‘‰ç¾æ²™ä»£", "è°ç”°çµµç¾å­"
            ];

            const defaultSupporters = [
                "äº€é‡ æµ©", "æ— æµç¾å­", "è¥¿æ‘ å­ä»", "å‡ºå£  èŒœè¦–", "æœ¨ä¸‹ è£•æ™ƒ", "å»£ç€¬ å„ª", 
                "æœ¨æ‘ å‡œ", "å¤åŸ çœŸå’²ä»£", "è—¤ç”° æ¢“å¹³", "å…¥æ±Ÿ éš†æµ©", "å’Œç”° çœŸç”±ç¾", "å’Œç”° éƒäºº", 
                "å— é‘‘æ†²", "æ£®å£  å½°", "å²©äº• æ³°å­", "ç›¸é¦¬ èŠ³å­", "å¥¥æ‘ ã•ã¤ã", "å¥¥æ‘ ç´˜å¹³", 
                "æ¾ä¸‹ ç´—å­£", "ä»Šè¥¿ å½©"
            ];

            const defaultDestinations = ["æ•£æ­©", "è²·ã„ç‰©", "å›³æ›¸é¤¨"];
            const defaultSupportTypes = ["ç§»å‹•æ”¯æ´", "è¡Œå‹•æ´è­·", "é€šé™¢ä»‹åŠ©"];
            const defaultAppearances = [
                "æ°—æŒã¡ãŒè‰¯ã•ãã†ã ã£ãŸ", "ç¬‘é¡”ãŒå¤šã„æ§˜å­ã ã£ãŸ", "å°‘ã—ç–²ã‚ŒãŸæ§˜å­ã ã£ãŸ", 
                "ã¾ãŸå¤–å‡ºã—ãŸã„ã¨è©±ã—ã¦ã„ãŸ", "å…ƒæ°—ãªæ§˜å­ã ã£ãŸ", "æ´»ç™ºã«å‹•ã‘ãŸ", 
                "å°‘ã—è½ã¡ç€ããŒãªã‹ã£ãŸ", "ä¸å®‰ãªè¡¨æƒ…ãŒè¦‹ãˆãŸ", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¤šã‹ã£ãŸ", "ç„¡å£ãªæ™‚é–“ãŒã‚ã£ãŸ"
            ];

            updateDatalist('users', defaultUsers);
            updateDatalist('supporters', defaultSupporters);
            updateDatalist('destinations', defaultDestinations);
            updateDatalist('support-types', defaultSupportTypes);
            updateDatalist('appearances', defaultAppearances);
            supporterSupportTypesMap = {}; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ™‚ã¯ç©º
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–ï¼ˆé«˜é€ŸåŒ–ç‰ˆï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            console.log("ğŸš€ é«˜é€ŸåˆæœŸåŒ–é–‹å§‹");
            
            // 1. å³åº§ã«åŸºæœ¬UIè¦ç´ ã‚’åˆæœŸåŒ–ï¼ˆæ—¥ä»˜ã€æ™‚é–“ãªã©ï¼‰
            initializeDateOptions();
            setCurrentDate();
            setLoggedInUserName();  // ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åå‰ã‚’æ”¯æ´å“¡1ã«è¨­å®š
            setupTimeFormatting();
            setupFormSubmission();
            
            // 2. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å³åº§ã«èª­ã¿è¾¼ã¿ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼‰
            loadDefaultData();
            
            // 3. æ”¯æ´å“¡å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š
            document.getElementById('supporter1-input').addEventListener('input', function(e) {
                const name = e.target.value.trim();
                updateSupportTypesForSupporter(name);
            });
            
            // 4. æ”¯æ´ç¨®åˆ¥å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š
            document.getElementById('support-type-input').addEventListener('input', function(e) {
                const supportType = e.target.value.trim();
                updateUserListBySupportType(supportType);
            });
            
            // 5. åˆ©ç”¨è€…å…¥åŠ›æ¬„ã®èƒŒæ™¯è‰²æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä¸€åº¦ã ã‘è¨­å®šï¼‰
            document.getElementById('user-input').addEventListener('input', function(e) {
                updateUserInputBackground(e.target.value, currentSupportType);
            });
            
            console.log("âœ… åŸºæœ¬åˆæœŸåŒ–å®Œäº† - ãƒšãƒ¼ã‚¸åˆ©ç”¨å¯èƒ½");
            
            // 4. ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆéãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ï¼‰
            setTimeout(() => {
                loadDataFromGAS();
            }, 100); // 100mså¾Œã«é–‹å§‹ï¼ˆUIãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å„ªå…ˆï¼‰
        });
        
        // Google Apps Scriptã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’éåŒæœŸå–å¾—
        async function loadDataFromGAS() {
            try {
                console.log("ğŸ”„ æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...");
                
                                        const dataUrl = 'https://script.google.com/macros/s/AKfycbzAVMj_SibFL5p6qXUxbma33CseiOqYCGhFgGUB5SAvtvpYdFcnWwyBaxIDlsAKKijx/exec?action=getData';
                
                const response = await fetch(dataUrl);
                const responseText = await response.text();
                const data = JSON.parse(responseText);
                
                if (data.success) {
                    // æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã§ãƒªã‚¹ãƒˆã‚’æ›´æ–°
                    updateDatalist('users', data.users || []);
                    updateDatalist('supporters', data.supporters || []);
                    updateDatalist('destinations', data.destinations || []);
                    updateDatalist('support-types', data.supportTypes || []);
                    updateDatalist('appearances', data.appearances || []);
                    supporterSupportTypesMap = data.supporterSupportTypes || {};
                    userRemainingTimesMap = data.userRemainingTimes || {};
                    allUsers = data.users || [];
                    
                    console.log("âœ… æœ€æ–°ãƒ‡ãƒ¼ã‚¿æ›´æ–°å®Œäº†");
                    showUpdateNotification("ğŸ“Š æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸ");
                } else {
                    console.warn("âš ï¸ ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:", data.error);
                    showUpdateNotification("âš ï¸ ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ", "warning");
                }
            } catch (error) {
                console.warn("âš ï¸ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼:", error.message);
                showUpdateNotification("ğŸ“´ ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œä¸­", "info");
            }
        }
        
        // é€šçŸ¥è¡¨ç¤ºæ©Ÿèƒ½
        function showUpdateNotification(message, type = "success") {
            const colors = {
                success: { bg: "#10b981", icon: "âœ…" },
                warning: { bg: "#f59e0b", icon: "âš ï¸" },
                info: { bg: "#3b82f6", icon: "â„¹ï¸" }
            };
            
            const color = colors[type] || colors.success;
            
            const notification = document.createElement('div');
            notification.innerHTML = `${color.icon} ${message}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${color.bg};
                color: white;
                padding: 12px 16px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                z-index: 1000;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s ease;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            document.body.appendChild(notification);
            
            // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ³
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // 3ç§’å¾Œã«ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¢ã‚¦ãƒˆ
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // æ—¥ä»˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–
        function initializeDateOptions() {
            const currentYear = new Date().getFullYear();
            const yearsDatalist = document.getElementById('years');
            for (let i = 0; i < 5; i++) {
                const option = document.createElement('option');
                option.value = currentYear - i;
                yearsDatalist.appendChild(option);
            }

            const monthsDatalist = document.getElementById('months');
            for (let i = 1; i <= 12; i++) {
                const option = document.createElement('option');
                option.value = i;
                monthsDatalist.appendChild(option);
            }

            const daysDatalist = document.getElementById('days');
            for (let i = 1; i <= 31; i++) {
                const option = document.createElement('option');
                option.value = i;
                daysDatalist.appendChild(option);
            }
        }

        // ç¾åœ¨ã®æ—¥ä»˜ã‚’è¨­å®š
        function setCurrentDate() {
            const now = new Date();
            document.getElementById('year').value = now.getFullYear();
            document.getElementById('month').value = now.getMonth() + 1;
            document.getElementById('day').value = now.getDate();
        }

        // ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åå‰ã‚’æ”¯æ´å“¡1æ¬„ã«è¨­å®š
        function setLoggedInUserName() {
            try {
                const userName = sessionStorage.getItem('userName');
                const userId = sessionStorage.getItem('userId');
                
                const supporter1Input = document.getElementById('supporter1-input');
                if (!supporter1Input) {
                    console.error('âŒ æ”¯æ´å“¡1ã®å…¥åŠ›æ¬„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                if (userName) {
                    supporter1Input.value = userName;
                    console.log(`âœ… æ”¯æ´å“¡1ã«è‡ªå‹•å…¥åŠ›: ${userName}`);
                    
                    // æ”¯æ´ç¨®åˆ¥ã®æ›´æ–°ã‚’ãƒˆãƒªã‚¬ãƒ¼
                    updateSupportTypesForSupporter(userName);
                } else if (userId) {
                    supporter1Input.value = userId;
                    console.log(`âœ… æ”¯æ´å“¡1ã«è‡ªå‹•å…¥åŠ›ï¼ˆIDä½¿ç”¨ï¼‰: ${userId}`);
                    
                    // æ”¯æ´ç¨®åˆ¥ã®æ›´æ–°ã‚’ãƒˆãƒªã‚¬ãƒ¼
                    updateSupportTypesForSupporter(userId);
                } else {
                    console.warn('âš ï¸ ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚index.htmlã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚');
                }
            } catch (error) {
                console.error('âŒ ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // æŒ‡å®šã•ã‚ŒãŸæ”¯æ´å“¡åã«åŸºã¥ã„ã¦æ”¯æ´ç¨®åˆ¥ã‚’æ›´æ–°
        function updateSupportTypesForSupporter(supporterName) {
            try {
                const name = supporterName.trim();
                let types = supporterSupportTypesMap[name];
                
                if (!types || types.length === 0) {
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ”¯æ´ç¨®åˆ¥
                    types = ["ç§»å‹•æ”¯æ´", "è¡Œå‹•æ´è­·", "é€šé™¢ä»‹åŠ©"];
                    console.log(`âš ï¸ ${name}ã®æ”¯æ´ç¨®åˆ¥ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚`);
                } else {
                    console.log(`âœ… ${name}ã®æ”¯æ´ç¨®åˆ¥ã‚’æ›´æ–°:`, types);
                }
                
                updateDatalist('support-types', types);
            } catch (error) {
                console.error('âŒ æ”¯æ´ç¨®åˆ¥æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // æ”¯æ´ç¨®åˆ¥ã«åŸºã¥ã„ã¦åˆ©ç”¨è€…ãƒªã‚¹ãƒˆã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        function updateUserListBySupportType(supportType) {
            console.log(`æ”¯æ´ç¨®åˆ¥ã€Œ${supportType}ã€ã«åŸºã¥ã„ã¦åˆ©ç”¨è€…ãƒªã‚¹ãƒˆã‚’æ›´æ–°`);
            console.log('ç¾åœ¨ã®allUsers:', allUsers);
            console.log('ç¾åœ¨ã®userRemainingTimesMap:', userRemainingTimesMap);
            
            // èƒŒæ™¯è‰²ã‚’æ±ºå®šã™ã‚‹é–¢æ•°
            function getBackgroundColor(minutes) {
                if (minutes <= 60) return '#ffcccc'; // èµ¤ï¼ˆ1:00ä»¥ä¸‹ï¼‰
                if (minutes <= 120) return '#ffffcc'; // é»„ï¼ˆ2:00ä»¥ä¸‹ï¼‰
                if (minutes <= 300) return '#ccccff'; // é’ï¼ˆ5:00ä»¥ä¸‹ï¼‰
                return ''; // ãã‚Œä»¥ä¸Šã¯èƒŒæ™¯è‰²ãªã—
            }
            
            const userDatalist = document.getElementById('users');
            userDatalist.innerHTML = ''; // æ—¢å­˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
            
            // æ”¯æ´ç¨®åˆ¥ãŒé¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã¯å…¨åˆ©ç”¨è€…ã‚’è¡¨ç¤º
            if (!supportType) {
                updateDatalist('users', allUsers);
                return;
            }
            
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸåˆ©ç”¨è€…ãƒªã‚¹ãƒˆã‚’ä½œæˆ
            const filteredUsers = [];
            
            allUsers.forEach(userName => {
                if (!userName || userName.trim() === '') return;
                
                const userTimes = userRemainingTimesMap[userName];
                console.log(`åˆ©ç”¨è€…ã€Œ${userName}ã€ã®æ®‹ã‚Šæ™‚é–“ãƒ‡ãƒ¼ã‚¿:`, userTimes);
                
                if (!userTimes) {
                    console.log(`åˆ©ç”¨è€…ã€Œ${userName}ã€: æ®‹ã‚Šæ™‚é–“ãƒ‡ãƒ¼ã‚¿ãªã—`);
                    return;
                }
                
                const remainingTime = userTimes[supportType];
                console.log(`åˆ©ç”¨è€…ã€Œ${userName}ã€ã®${supportType}æ®‹ã‚Šæ™‚é–“: "${remainingTime}"`);
                
                if (!remainingTime || remainingTime === '') {
                    console.log(`åˆ©ç”¨è€…ã€Œ${userName}ã€: ${supportType}ã®æ®‹ã‚Šæ™‚é–“ãªã—`);
                    return;
                }
                
                // æ®‹ã‚Šæ™‚é–“ãŒã‚ã‚‹åˆ©ç”¨è€…ã®ã¿è¿½åŠ 
                const minutes = timeToMinutes(remainingTime);
                console.log(`åˆ©ç”¨è€…ã€Œ${userName}ã€: ${remainingTime} = ${minutes}åˆ†`);
                
                if (minutes > 0) {
                    const option = document.createElement('option');
                    option.value = userName;
                    
                    // èƒŒæ™¯è‰²ã‚’è¨­å®š
                    const color = getBackgroundColor(minutes);
                    if (color) {
                        // ãƒ‡ãƒ¼ã‚¿ãƒªã‚¹ãƒˆã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¯ã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã•ã‚Œãªã„ãŸã‚ã€
                        // ã‚«ã‚¹ã‚¿ãƒ å±æ€§ã¨ã—ã¦ä¿å­˜
                        option.setAttribute('data-color', color);
                        option.setAttribute('data-minutes', minutes);
                    }
                    
                    userDatalist.appendChild(option);
                    filteredUsers.push(userName);
                    console.log(`åˆ©ç”¨è€…ã€Œ${userName}ã€ã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ `);
                } else {
                    console.log(`åˆ©ç”¨è€…ã€Œ${userName}ã€: æ®‹ã‚Šæ™‚é–“0åˆ†ã®ãŸã‚é™¤å¤–`);
                }
            });
            
            console.log(`${supportType}ã§æ®‹ã‚Šæ™‚é–“ãŒã‚ã‚‹åˆ©ç”¨è€…: ${filteredUsers.length}å (${filteredUsers.join(', ')})`);
            
            // ç¾åœ¨ã®æ”¯æ´ç¨®åˆ¥ã‚’ä¿å­˜
            currentSupportType = supportType;
        }
        
        // æ™‚é–“ã‚’åˆ†ã«å¤‰æ›ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function timeToMinutes(timeStr) {
            if (!timeStr || typeof timeStr !== 'string') return 0;
            
            // ISOæ—¥ä»˜å½¢å¼ã®å ´åˆï¼ˆä¾‹: "1899-12-30T06:00:00.000Z"ï¼‰
            if (timeStr.includes('T') && timeStr.includes('Z')) {
                try {
                    const date = new Date(timeStr);
                    const hours = date.getUTCHours();
                    const minutes = date.getUTCMinutes();
                    return hours * 60 + minutes;
                } catch (error) {
                    console.error('ISOæ—¥ä»˜ã®è§£æã‚¨ãƒ©ãƒ¼:', error, timeStr);
                    return 0;
                }
            }
            
            // HH:MMå½¢å¼ã®å ´åˆ
            const parts = timeStr.split(':');
            if (parts.length !== 2) return 0;
            const hours = parseInt(parts[0]) || 0;
            const minutes = parseInt(parts[1]) || 0;
            return hours * 60 + minutes;
        }
        
        // åˆ©ç”¨è€…å…¥åŠ›æ¬„ã®èƒŒæ™¯è‰²ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        function updateUserInputBackground(userName, supportType) {
            const userInput = document.getElementById('user-input');
            
            if (!userName || !supportType || !userRemainingTimesMap[userName]) {
                userInput.style.backgroundColor = '';
                return;
            }
            
            const remainingTime = userRemainingTimesMap[userName][supportType];
            if (!remainingTime) {
                userInput.style.backgroundColor = '';
                return;
            }
            
            
            const minutes = timeToMinutes(remainingTime);
            
            // èƒŒæ™¯è‰²ã‚’è¨­å®š
            if (minutes <= 60) {
                userInput.style.backgroundColor = '#ffcccc'; // èµ¤
            } else if (minutes <= 120) {
                userInput.style.backgroundColor = '#ffffcc'; // é»„
            } else if (minutes <= 300) {
                userInput.style.backgroundColor = '#ccccff'; // é’
            } else {
                userInput.style.backgroundColor = '';
            }
        }

        // æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®š
        function setupTimeFormatting() {
            function formatTime(event) {
                console.log("formatTime called for:", event.target.id);
                const inputElement = event.target;
                let value = inputElement.value.replace(/[^0-9]/g, '');

                if (value === '') {
                    inputElement.value = '';
                    return;
                }

                let hour, minute;

                if (value.length <= 2) {
                    hour = parseInt(value, 10);
                    minute = 0;
                } else {
                    minute = parseInt(value.slice(-2), 10);
                    hour = parseInt(value.slice(0, -2), 10);
                }

                hour = isNaN(hour) ? 0 : hour;
                minute = isNaN(minute) ? 0 : minute;

                if (hour > 23) {
                    hour = 23;
                }
                if (minute > 59) {
                    minute = 59;
                }

                const formattedHour = hour.toString();
                const formattedMinute = minute.toString().padStart(2, '0');
                inputElement.value = `${formattedHour}:${formattedMinute}`;
            }

            document.getElementById('start-time').addEventListener('blur', formatTime);
            document.getElementById('end-time').addEventListener('blur', formatTime);
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡è¨­å®š
        function setupFormSubmission() {
            document.getElementById('recordForm').addEventListener('submit', function(event) {
                event.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é€ä¿¡ã‚’é˜²ã
                
                // å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’å–å¾—
                const year = document.getElementById('year').value;
                const month = document.getElementById('month').value;
                const day = document.getElementById('day').value;
                const startTime = document.getElementById('start-time').value;
                const endTime = document.getElementById('end-time').value;
                const user = document.getElementById('user-input').value;
                const supporter1 = document.getElementById('supporter1-input').value;
                const supporter2 = document.getElementById('supporter2-input').value;
                const destination = document.getElementById('destination-input').value;
                const supportType = document.getElementById('support-type-input').value;
                const appearance = document.getElementById('appearance-input').value;
                const userCheck = document.getElementById('check1').checked ? 'ã¯ã„' : 'ã„ã„ãˆ';
                
                // ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆ
                const confirmMessage = `ä»¥ä¸‹ã®å†…å®¹ã§é€ä¿¡ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ

ğŸ“… æ—¥ä»˜: ${year}å¹´${month}æœˆ${day}æ—¥
â° æ™‚é–“: ${startTime} ï½ ${endTime}
ğŸ‘¤ åˆ©ç”¨è€…: ${user}
ğŸ‘¥ æ”¯æ´å“¡1: ${supporter1}
ğŸ‘¥ æ”¯æ´å“¡2: ${supporter2}
ğŸ“ è¡Œãå…ˆ: ${destination}
ğŸ·ï¸ æ”¯æ´ç¨®åˆ¥: ${supportType}
ğŸ˜Š æ§˜å­: ${appearance}
âœ… åˆ©ç”¨è€…æ§˜ç¢ºèª: ${userCheck}`;
                
                if (!confirm(confirmMessage)) {
                    return false;
                }
                
                // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
                submitFormData({
                    year, month, day, startTime, endTime,
                    user, supporter1, supporter2, destination,
                    supportType, userCheck, appearance
                });
            });
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’AJAXã§é€ä¿¡
        async function submitFormData(formData) {
            const resultDiv = document.getElementById('submissionResult');
            const resultMessage = document.getElementById('resultMessage');
            
            try {
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
                resultDiv.className = 'mt-4 p-3 rounded bg-blue-100 border border-blue-400';
                resultMessage.textContent = 'é€ä¿¡ä¸­...';
                resultDiv.classList.remove('hidden');
                
                console.log('=== ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡é–‹å§‹ ===');
                console.log('é€ä¿¡ãƒ‡ãƒ¼ã‚¿:', formData);
                
                // FormDataã‚’ä½œæˆ
                const formDataObj = new FormData();
                Object.keys(formData).forEach(key => {
                    formDataObj.append(key, formData[key]);
                    console.log(`FormDataè¿½åŠ : ${key} = ${formData[key]}`);
                });
                
                const submitUrl = 'https://script.google.com/macros/s/AKfycbzAVMj_SibFL5p6qXUxbma33CseiOqYCGhFgGUB5SAvtvpYdFcnWwyBaxIDlsAKKijx/exec';
                console.log('é€ä¿¡URL:', submitUrl);
                
                const response = await fetch(submitUrl, {
                    method: 'POST',
                    body: formDataObj
                });
                
                console.log('ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:', response.status);
                console.log('ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼:', response.headers);
                
                const result = await response.text();
                console.log('é€ä¿¡çµæœï¼ˆç”Ÿãƒ†ã‚­ã‚¹ãƒˆï¼‰:', result);
                
                try {
                    const jsonResult = JSON.parse(result);
                    console.log('é€ä¿¡çµæœï¼ˆJSONï¼‰:', jsonResult);
                    
                    if (jsonResult.success) {
                        // æˆåŠŸ
                        resultDiv.className = 'mt-4 p-3 rounded bg-green-100 border border-green-400';
                        resultMessage.textContent = `âœ… ${jsonResult.message || 'è¨˜éŒ²ãŒæ­£å¸¸ã«é€ä¿¡ã•ã‚Œã¾ã—ãŸ'}`;
                        
                        // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
                        document.getElementById('recordForm').reset();
                        setCurrentDate(); // æ—¥ä»˜ã‚’å†è¨­å®š
                        setLoggedInUserName(); // æ”¯æ´å“¡åã‚’å†è¨­å®š
                    } else {
                        // ã‚¨ãƒ©ãƒ¼
                        resultDiv.className = 'mt-4 p-3 rounded bg-red-100 border border-red-400';
                        resultMessage.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${jsonResult.error}`;
                    }
                } catch (parseError) {
                    console.error('JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:', parseError);
                    console.error('ãƒ‘ãƒ¼ã‚¹å¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆ:', result);
                    // JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼
                    resultDiv.className = 'mt-4 p-3 rounded bg-yellow-100 border border-yellow-400';
                    resultMessage.textContent = 'âš ï¸ ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ã‚’è§£æã§ãã¾ã›ã‚“ã§ã—ãŸãŒã€é€ä¿¡ã¯å®Œäº†ã—ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚';
                }
                
            } catch (error) {
                console.error('é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
                resultDiv.className = 'mt-4 p-3 rounded bg-red-100 border border-red-400';
                resultMessage.textContent = `âŒ é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`;
            }
            
            // 5ç§’å¾Œã«çµæœã‚’éè¡¨ç¤º
            setTimeout(() => {
                resultDiv.classList.add('hidden');
            }, 5000);
        }

        // ç©ºç™½è¡Œã‚’éè¡¨ç¤ºã«ã™ã‚‹é–¢æ•°
        function hideEmptyRows(sheet, startRow, endRow) {
          const hiddenRows = [];
          
          try {
            console.log(`ç©ºç™½è¡Œãƒã‚§ãƒƒã‚¯: ${startRow}è¡Œç›®ï½${endRow}è¡Œç›®`);
            
            // å„è¡Œã‚’ãƒã‚§ãƒƒã‚¯
            for (let row = startRow; row <= endRow; row++) {
              // Aåˆ—ã®å€¤ã‚’å–å¾—
              const valueA = sheet.getRange(row, 1).getValue();
              
              // Aåˆ—ãŒç©ºç™½ã¾ãŸã¯ç©ºæ–‡å­—ã®å ´åˆ
              if (!valueA || valueA.toString().trim() === '') {
                // è¡Œã‚’éè¡¨ç¤ºã«ã™ã‚‹
                sheet.hideRows(row, 1);
                hiddenRows.push(row);
              }
            }
            
            console.log(`éè¡¨ç¤ºã«ã—ãŸè¡Œ: ${hiddenRows.length}è¡Œ`);
            return hiddenRows;
            
          } catch (error) {
            console.error('ç©ºç™½è¡Œéè¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
            return hiddenRows;
          }
        }

        // Admin menu
        document.addEventListener('DOMContentLoaded', function() {
            const userRole = sessionStorage.getItem('userRole');
            if (userRole === 'admin') {
                const adminMenu = document.getElementById('admin-menu');
                const button = document.createElement('button');
                button.textContent = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†';
                button.className = 'admin-button';
                button.onclick = function() {
                    window.location.href = 'admin.html';
                };
                adminMenu.appendChild(button);
            }
        });
    </script>
</body></html>