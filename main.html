<!DOCTYPE html>
<html lang="ja"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>積み木記録表</title>

<!-- PWA対応：アイコン設定 -->
<link rel="icon" type="image/png" sizes="32x32" href="tumiki-icon.png">
<link rel="icon" type="image/png" sizes="16x16" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="152x152" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="144x144" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="120x120" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="114x114" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="76x76" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="72x72" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="60x60" href="tumiki-icon.png">
<link rel="apple-touch-icon" sizes="57x57" href="tumiki-icon.png">
<link rel="apple-touch-icon" href="tumiki-icon.png">

<!-- PWAマニフェスト -->
<link rel="manifest" href="manifest.json">

<!-- iOS用メタタグ -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="積み木">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#ffffff">

<link rel="stylesheet" href="style.css">
<style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            background-color: #ffe4cc;
            overflow: hidden;
        }
        
        /*スマートフォン最適化 */
        .smartphone-container {
            width: 100%;
            height: 100vh;
            margin: 0;
            padding: 4px;
            box-sizing: border-box;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            overflow-y: auto;
        }
        
        .form-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 8px;
            border: 1px solid #e5e7eb;
            width: 100%;
            max-width: 320px;
        }
        
        /* タイトル */
        .title-box {
            border: 2px solid #9ca3af;
            padding: 3px;
            text-align: center;
            margin-bottom: 16px;
            border-radius: 6px;
            background-color: #ffe4cc;
            margin-top: 0;
        }
        
        .title-text {
            font-size: 20px;
            font-weight: bold;
            letter-spacing: 0.1em;
            color: #1f2937;
        }
        
        /* 日付入力エリア */
        .date-container {
            display: grid;
            grid-template-columns: 1.4fr auto 1fr auto 1fr auto;
            gap: 8px;
            align-items: center;
            margin-bottom: 16px;
            padding: 5px 12px !important;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #d1d5db;
        }
        
        .date-input {
            width: 100%;
            height: 28px !important;
            text-align: center;
            font-size: 16px !important;
            font-weight: 600;
            border: none;
            border-bottom: 2px solid #9ca3af !important;
            background: transparent;
            outline: none;
            transition: border-color 0.2s;
            min-width: 0;
        }
        
        .date-input:focus {
            border-bottom-color: #3b82f6;
        }
        
        .date-label {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
        }
        
        /* 時間入力エリア */
        .time-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 16px;
            align-items: center;
            margin-bottom: 16px;
            padding: 5px 12px !important;
            background: #f0f9ff;
            border-radius: 8px;
            border: 1px solid #0ea5e9;
        }
        
        .time-input {
            width: 100%;
            height: 28px !important;
            text-align: center;
            font-size: 16px !important;
            font-weight: 600;
            border: none;
            border-bottom: 2px solid #0ea5e9 !important;
            background: transparent;
            outline: none;
            transition: border-color 0.2s;
            min-width: 0;
        }
        
        .time-input:focus {
            border-bottom-color: #0284c7;
        }
        
        .time-separator {
            font-size: 20px;
            font-weight: bold;
            color: #0ea5e9;
        }
        
        /* 入力フィールド共通 */
        .input-row {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            background: #e5e7eb;
            padding: 8px 12px;
            border: 1px solid #9ca3af;
            border-radius: 6px;
            min-width: 50px;
            text-align: center;
            white-space: nowrap;
        }
        
        .input-field {
            flex: 1;
            height: 44px;
            padding: 0 12px;
            font-size: 14px;
            border: none;
            border-bottom: 3px solid #9ca3af;
            background: transparent;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .input-field:focus {
            border-bottom-color: #3b82f6;
        }
        
        /* select要素用の追加スタイル */
        select.input-field {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }
        
        select.input-field:hover {
            border-bottom-color: #6b7280;
        }
        
        select.input-field option {
            background: white;
            color: #1f2937;
            padding: 8px;
        }
        
        /* 利用者選択ドロップダウンの色付きオプション */
        #user-input option[style*="background-color"] {
            font-weight: 500;
        }
        
        /* モバイル用カスタムドロップダウン */
        .custom-dropdown {
            position: relative;
            display: none; /* デフォルトは非表示 */
            flex: 1; /* 親要素の幅に合わせる */
        }
        
        .custom-dropdown.mobile-active {
            display: block;
        }
        
        .custom-dropdown-button {
            width: 100%;
            height: 48px;
            padding: 0 40px 0 16px;
            font-size: 16px;
            border: none;
            border-bottom: 3px solid #9ca3af;
            background: transparent;
            outline: none;
            cursor: pointer;
            text-align: left;
            position: relative;
            transition: border-color 0.2s;
        }
        
        .custom-dropdown-button:focus {
            border-bottom-color: #3b82f6;
        }
        
        .custom-dropdown-button::after {
            content: '';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid #6b7280;
            transition: transform 0.2s;
        }
        
        .custom-dropdown-button.active::after {
            transform: translateY(-50%) rotate(180deg);
        }
        
        .custom-dropdown-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .custom-dropdown-list.show {
            display: block;
        }
        
        .custom-dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            font-size: 16px;
            transition: background-color 0.2s;
        }
        
        .custom-dropdown-item:last-child {
            border-bottom: none;
        }
        
        .custom-dropdown-item:hover {
            background-color: #f9fafb;
        }
        
        .custom-dropdown-item.selected {
            background-color: #e5e7eb;
            font-weight: 600;
        }
        
        /* 色分け用のカスタムドロップダウンアイテム */
        .custom-dropdown-item.time-red {
            background-color: #ffcccc !important;
        }
        
        .custom-dropdown-item.time-yellow {
            background-color: #ffffcc !important;
        }
        
        .custom-dropdown-item.time-cyan {
            background-color: #ccffff !important;
        }
        
        /* モバイル時は元のselectを隠す */
        .mobile-device #user-input {
            display: none;
        }
        
        /* 日付確認モーダルのスタイル */
        .warning-icon {
            font-size: 48px;
            text-align: center;
            margin: 16px 0;
        }
        
        .date-info {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        
        .date-comparison {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .today-date,
        .input-date {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-radius: 4px;
        }
        
        .today-date {
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
        }
        
        .input-date {
            background: #fef3c7;
            border: 1px solid #fbbf24;
        }
        
        .date-label {
            font-weight: 600;
            color: #374151;
        }
        
        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 24px;
        }
        
        .btn-ok,
        .btn-cancel {
            padding: 12px 24px;
            border-radius: 6px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            min-width: 120px;
            transition: all 0.2s;
        }
        
        .btn-ok {
            background: #3b82f6;
            color: white;
        }
        
        .btn-ok:hover {
            background: #2563eb;
        }
        
        .btn-cancel {
            background: #6b7280;
            color: white;
        }
        
        .btn-cancel:hover {
            background: #4b5563;
        }
        
        /* 送信中のスピンアニメーション */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 時間入力欄のプレースホルダーを薄くする */
        .time-input::placeholder {
            color: #d1d5db;
            opacity: 0.7;
        }
        
        .time-input::-webkit-input-placeholder {
            color: #d1d5db;
            opacity: 0.7;
        }
        
        .time-input::-moz-placeholder {
            color: #d1d5db;
            opacity: 0.7;
        }
        
        .time-input:-ms-input-placeholder {
            color: #d1d5db;
            opacity: 0.7;
        }
        
        /* 確認欄 */
        .confirmation-box {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 4px;
            padding: 1px;
            margin: 10px 0;
        }
        
        .confirmation-title {
            font-size: 12px;
            font-weight: bold;
            color: #92400e;
            margin-bottom: 5px;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-input {
            width: 20px;
            height: 20px;
            accent-color: #3b82f6;
        }
        
        .checkbox-label {
            font-size: 16px;
            font-weight: 600;
            color: #92400e;
        }
        
        .warning-text {
            color: #dc2626;
            font-size: 12px;
            margin-top: 6px;
        }
        
        /* 段階的ドロップダウンUI */
        .user-dropdown-container {
            flex: 1;
            position: relative;
        }
        
        .user-dropdown {
            position: relative;
            width: 100%;
        }
        
        .user-dropdown-button {
            width: 100%;
            height: 44px;
            padding: 0 12px;
            font-size: 14px;
            border: none;
            border-bottom: 3px solid #9ca3af;
            background: transparent;
            text-align: left;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        
        .user-dropdown-button:focus {
            outline: none;
            border-bottom-color: #3b82f6;
        }
        
        .user-dropdown-menu {
            position: absolute;
            top: 44px;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 100;
            max-height: 250px;
            overflow-y: auto;
        }
        
        .user-dropdown-menu.hidden {
            display: none;
        }
        
        /* 50音選択画面のスタイル */
        .kana-selection {
            padding: 8px;
        }
        
        .dropdown-option {
            display: inline-block;
            min-width: 32px;
            height: 32px;
            margin: 2px;
            padding: 0 8px;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .dropdown-option:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }
        
        .dropdown-option:first-child {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }
        
        .dropdown-option:first-child:hover {
            background: #059669;
        }
        
        /* 利用者一覧画面のスタイル */
        .user-list-view {
            padding: 8px;
        }
        
        .back-button {
            width: 100%;
            padding: 8px 12px;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid #9ca3af;
            background: #f9fafb;
            color: #374151;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .back-button:hover {
            background: #f3f4f6;
            border-color: #6b7280;
        }
        
        .user-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 6px;
        }
        
        .user-option {
            padding: 8px 12px;
            font-size: 14px;
            font-weight: 500;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .user-option:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }
        
        /* 残り時間による色分け */
        .user-option.time-red {
            background: #ffcccc;
            border-color: #ff9999;
        }
        
        .user-option.time-yellow {
            background: #ffffcc;
            border-color: #ffff99;
        }
        
        .user-option.time-cyan {
            background: #ccffff;
            border-color: #99ffff;
        }

        /* 送信ボタン */
        .submit-button {
            width: 100%;
            height: 56px;
            background: #3b82f6;
            color: white;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            margin-top: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .submit-button:hover {
            background: #2563eb;
        }
        
        .submit-button:active {
            transform: translateY(1px);
        }
        
        /* 管理者メニュー */
        .admin-menu {
            text-align: right;
            margin-bottom: 16px;
        }
        
        .admin-button {
            background: #10b981;
            color: white;
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            border: none;
            cursor: pointer;
        }
        
        .admin-button:hover {
            background: #059669;
        }
        
        
        /* モーダルスタイル */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-overlay.hidden {
            display: none;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            color: #6b7280;
            cursor: pointer;
            transition: color 0.2s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }
        
        .modal-close:hover {
            color: #1f2937;
            background: #f3f4f6;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .success-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 16px;
        }
        
        .modal-message {
            font-size: 18px;
            text-align: center;
            color: #1f2937;
            margin-bottom: 24px;
        }
        
        .submitted-data {
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
        }
        
        .submitted-data h3 {
            font-size: 16px;
            font-weight: bold;
            color: #374151;
            margin: 0 0 12px 0;
        }
        
        .data-table {
            width: 100%;
            font-size: 14px;
        }
        
        .data-table tr {
            border-bottom: 1px solid #e5e7eb;
        }
        
        .data-table tr:last-child {
            border-bottom: none;
        }
        
        .data-table th {
            text-align: left;
            padding: 8px 12px;
            color: #6b7280;
            font-weight: 600;
            white-space: nowrap;
            width: 35%;
        }
        
        .data-table td {
            padding: 8px 12px;
            color: #1f2937;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: center;
        }
        
        .modal-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .modal-button:hover {
            background: #2563eb;
        }
        
        .modal-button:active {
            transform: translateY(1px);
        }
        
        /* アニメーション */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* レスポンシブ調整 */
        @media (max-width: 480px) {
            .smartphone-container {
                padding: 4px;
            }
            
            .form-container {
                padding: 6px;
                max-width: 300px;
            }
            
            .date-container {
                grid-template-columns: 1.2fr auto 0.8fr auto 0.8fr auto;
                gap: 6px;
                padding: 12px 8px;
            }
            
            .time-container {
                grid-template-columns: 1fr auto 1fr;
                gap: 12px;
                padding: 12px 8px;
            }
            
            .input-row {
                flex-direction: row;
                align-items: center;
                gap: 8px;
            }
            
            .input-label {
                min-width: 40px;
                text-align: center;
                font-size: 12px;
                padding: 6px 8px;
            }
            
            .input-field {
                height: 40px;
                font-size: 14px;
                padding: 0 8px;
            }
            
            .date-input, .time-input {
                height: 48px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="smartphone-container">
        <div class="form-container">
            <div id="admin-menu" class="admin-menu"></div>
            
            <form id="recordForm" method="POST">
                <!-- タイトル -->
                <div class="title-box">
                    <h1 class="title-text">積み木記録表</h1>
                </div>

                <!-- 日付入力 -->
                <div class="date-container">
                    <input id="year" name="year" class="date-input" placeholder="2024" required>
                    <span class="date-label">年</span>

                    <input id="month" name="month" class="date-input" placeholder="7" required>
                    <span class="date-label">月</span>

                    <input id="day" name="day" class="date-input" placeholder="20" required>
                    <span class="date-label">日</span>
                </div>

                <!-- 時間入力 -->
                <div class="time-container">
                    <input id="start-time" name="startTime" class="time-input" placeholder="9:00" required>
                    <span class="time-separator">~</span>
                    <input id="end-time" name="endTime" class="time-input" placeholder="12:00" required>
                </div>

                <!-- 支援員1 -->
                <div class="input-row">
                    <label class="input-label" for="supporter1-input">支援員1</label>
                    <select id="supporter1-input" name="supporter1" class="input-field" required>
                        <option value="">選択してください</option>
                        <!-- 動的に生成されます -->
                    </select>
                </div>

                <!-- 支援員2 -->
                <div class="input-row">
                    <label class="input-label" for="supporter2-input">支援員2</label>
                    <select id="supporter2-input" name="supporter2" class="input-field">
                        <option value="">選択してください</option>
                        <!-- 動的に生成されます -->
                    </select>
                </div>

                <!-- 支援種別 -->
                <div class="input-row">
                    <label class="input-label" for="support-type-input">支援種別</label>
                    <select id="support-type-input" name="supportType" class="input-field" required>
                        <option value="">選択してください</option>
                        <!-- 動的に生成されます -->
                    </select>
                </div>


                <!-- 利用者 -->
                <div class="input-row">
                    <label class="input-label" for="user-dropdown">利用者</label>
                    <div class="user-dropdown-container">
                        <!-- 段階的ドロップダウンUI -->
                        <div class="user-dropdown" id="user-dropdown">
                            <!-- 状態1: 初期表示 -->
                            <button type="button" class="user-dropdown-button" id="user-dropdown-button">
                                選択してください ▼
                            </button>
                            
                            <!-- 状態2: 50音選択画面 -->
                            <div class="user-dropdown-menu kana-selection hidden" id="kana-selection">
                                <button type="button" class="dropdown-option" data-kana="">全て</button>
                                <button type="button" class="dropdown-option" data-kana="あ">あ</button>
                                <button type="button" class="dropdown-option" data-kana="か">か</button>
                                <button type="button" class="dropdown-option" data-kana="さ">さ</button>
                                <button type="button" class="dropdown-option" data-kana="た">た</button>
                                <button type="button" class="dropdown-option" data-kana="な">な</button>
                                <button type="button" class="dropdown-option" data-kana="は">は</button>
                                <button type="button" class="dropdown-option" data-kana="ま">ま</button>
                                <button type="button" class="dropdown-option" data-kana="や">や</button>
                                <button type="button" class="dropdown-option" data-kana="ら">ら</button>
                                <button type="button" class="dropdown-option" data-kana="わ">わ</button>
                            </div>
                            
                            <!-- 状態3: 利用者一覧画面 -->
                            <div class="user-dropdown-menu user-list-view hidden" id="user-list-view">
                                <button type="button" class="back-button" id="back-to-kana">← 戻る</button>
                                <div class="user-options" id="user-options">
                                    <!-- 動的に生成される利用者ボタン -->
                                </div>
                            </div>
                        </div>
                        <!-- フォーム送信用の隠し入力フィールド -->
                        <input type="hidden" id="user-input" name="user" required>
                    </div>
                </div>

                <!-- 行き先 -->
                <div class="input-row">
                    <label class="input-label" for="destination-input">行き先</label>
                    <input id="destination-input" name="destination" class="input-field" list="destination-list" placeholder="選択/入力" required>
                    <datalist id="destination-list">
                        <!-- 動的に生成されます -->
                    </datalist>
                </div>

                <!-- 利用者様確認欄 -->
                <div class="confirmation-box">
                    <p class="confirmation-title">利用者様確認欄</p>
                    <div class="checkbox-container">
                        <input type="checkbox" id="check1" name="userCheck" class="checkbox-input" required>
                        <label for="check1" class="checkbox-label">上記内容を確認しました。</label>
                    </div>
                    <p class="warning-text">※利用者様にチェックをもらってください。</p>
                </div>
                
                <!-- 様子 -->
                <div class="input-row">
                    <label class="input-label" for="appearance-input">様子</label>
                    <input id="appearance-input" name="appearance" class="input-field" list="appearance-list" placeholder="選択/入力" required>
                    <datalist id="appearance-list">
                        <!-- 動的に生成されます -->
                    </datalist>
                </div>

                <!-- 次回通院日（通院等介助選択時のみ表示） -->
                <div id="next-visit-section" style="display: none;">
                    <div class="input-row">
                        <label class="input-label" for="next-visit-date-input">次回通院日</label>
                        <input id="next-visit-date-input" name="nextVisitDate" type="date" class="input-field">
                    </div>
                    <div class="input-row">
                        <label class="input-label" for="next-visit-time-input">次回通院時刻</label>
                        <input id="next-visit-time-input" name="nextVisitTime" type="time" class="input-field">
                    </div>
                    <div class="input-row">
                        <label class="input-label" for="hospital-name-input">病院名</label>
                        <input id="hospital-name-input" name="hospitalName" type="text" class="input-field" placeholder="病院名を入力">
                    </div>
                </div>

                <!-- 送信ボタン -->
                <button type="submit" class="submit-button">記録を送信</button>
            </form>
        </div>
    </div>

    <script>
        console.log("Script loaded and running");

        let supporterSupportTypesMap = {};
        let userRemainingTimesMap = {};
        let allUsers = [];
        let currentSupportType = ''; // 現在選択されている支援種別を保持
        let userFuriganaData = {}; // 利用者フリガナデータ



        // datalist要素を更新する関数
        function updateDatalistOptions(datalistId, items) {
            console.log(`📝 datalist ${datalistId} を更新中... アイテム数: ${items.length}`);
            const datalistElement = document.getElementById(datalistId);
            
            if (!datalistElement) {
                console.error(`❌ datalist要素が見つかりません: ${datalistId}`);
                return;
            }
            
            // 既存のオプションをクリア
            datalistElement.innerHTML = '';
            
            // "-" や空白、null、undefinedを除外して追加
            const filteredItems = items.filter(item =>
                item && item.toString().trim() !== '' && item.toString().trim() !== '-'
            );
            
            filteredItems.forEach((item, index) => {
                const option = document.createElement('option');
                option.value = item;
                datalistElement.appendChild(option);
                if (index < 3) { // 最初の3つだけログ出力
                    console.log(`➕ datalist ${datalistId}[${index}]: ${item}`);
                }
            });
            
            console.log(`✅ datalist ${datalistId} の更新完了（${filteredItems.length}個のオプション、${items.length - filteredItems.length}個除外）`);
        }

        // select要素を更新する関数（datalist対応版）
        function updateSelectOptions(selectId, items) {
            console.log(`📝 ${selectId} を更新中... アイテム数: ${items.length}`);
            
            // 利用者リストの場合はアイウエオ順にソート
            if (selectId === 'user-input') {
                items = sortUsersByKana(items);
            }
            
            // datalist対応のチェック（行き先・様子欄）
            if (selectId === 'destination-input') {
                updateDatalistOptions('destination-list', items);
                return;
            }
            if (selectId === 'appearance-input') {
                updateDatalistOptions('appearance-list', items);
                return;
            }
            
            // 従来のselect要素の処理
            const selectElement = document.getElementById(selectId);
            
            if (!selectElement) {
                console.error(`❌ select要素が見つかりません: ${selectId}`);
                return;
            }
            
            // 既存のオプションをクリア（最初の「選択してください」オプションは保持）
            const firstOption = selectElement.querySelector('option[value=""]');
            selectElement.innerHTML = '';
            if (firstOption) {
                selectElement.appendChild(firstOption);
            } else {
                // 「選択してください」オプションがない場合は作成
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = '選択してください';
                selectElement.appendChild(defaultOption);
            }
            console.log(`🗑️ ${selectId} の既存オプションをクリアしました`);
            
            // "-" や空白、null、undefinedを除外して追加
            const filteredItems = items.filter(item =>
                item && item.toString().trim() !== '' && item.toString().trim() !== '-'
            );
            
            filteredItems.forEach((item, index) => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                selectElement.appendChild(option);
                if (index < 3) { // 最初の3つだけログ出力
                    console.log(`➕ ${selectId}[${index}]: ${item}`);
                }
            });
            
            console.log(`✅ ${selectId} の更新完了（${filteredItems.length}個のオプション、${items.length - filteredItems.length}個除外）`);
        }

        // モバイル端末検出
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // カスタムドロップダウンの初期化とイベント設定
        function initializeCustomDropdown() {
            const customDropdown = document.getElementById('custom-user-dropdown');
            const customButton = document.getElementById('custom-user-button');
            const customList = document.getElementById('custom-user-list');
            const originalSelect = document.getElementById('user-input');

            if (!customDropdown || !customButton || !customList || !originalSelect) {
                console.error('カスタムドロップダウンの要素が見つかりません');
                return;
            }

            // ドロップダウンボタンクリック
            customButton.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const isOpen = customList.classList.contains('show');
                if (isOpen) {
                    customList.classList.remove('show');
                    customButton.classList.remove('active');
                } else {
                    customList.classList.add('show');
                    customButton.classList.add('active');
                }
            });

            // 外部クリックでドロップダウンを閉じる
            document.addEventListener('click', function(e) {
                if (!customDropdown.contains(e.target)) {
                    customList.classList.remove('show');
                    customButton.classList.remove('active');
                }
            });

            // アイテム選択
            customList.addEventListener('click', function(e) {
                if (e.target.classList.contains('custom-dropdown-item')) {
                    const value = e.target.dataset.value;
                    const text = e.target.textContent;
                    
                    // 選択状態を更新
                    customList.querySelectorAll('.custom-dropdown-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    e.target.classList.add('selected');
                    
                    // ボタンテキストを更新
                    customButton.textContent = text;
                    
                    // 元のselectの値を同期
                    originalSelect.value = value;
                    
                    // changeイベントを発火
                    const changeEvent = new Event('change', { bubbles: true });
                    originalSelect.dispatchEvent(changeEvent);
                    
                    // ドロップダウンを閉じる
                    customList.classList.remove('show');
                    customButton.classList.remove('active');
                }
            });
        }

        // カスタムドロップダウンを更新する関数
        function updateCustomDropdown(items, supportType) {
            console.log(`🎨 カスタムドロップダウンを更新中... アイテム数: ${items.length}, 支援種別: ${supportType}`);
            
            const customList = document.getElementById('custom-user-list');
            const customButton = document.getElementById('custom-user-button');
            
            if (!customList || !customButton) {
                console.error('カスタムドロップダウンの要素が見つかりません');
                return;
            }
            
            // リストをクリア
            customList.innerHTML = '';
            
            // 背景色を決定する関数
            function getTimeColorClass(minutes) {
                if (minutes <= 60) return 'time-red'; // 赤（1:00以下）
                if (minutes <= 120) return 'time-yellow'; // 黄（2:00以下）
                if (minutes <= 300) return 'time-cyan'; // 薄い水色（5:00以下）
                return ''; // それ以上は背景色なし
            }
            
            // "選択してください"オプション
            const defaultItem = document.createElement('div');
            defaultItem.className = 'custom-dropdown-item';
            defaultItem.dataset.value = '';
            defaultItem.textContent = '選択してください';
            customList.appendChild(defaultItem);
            
            // フィルタリングされたアイテムを追加
            const filteredItems = items.filter(item =>
                item && item.toString().trim() !== '' && item.toString().trim() !== '-'
            );
            
            filteredItems.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'custom-dropdown-item';
                itemElement.dataset.value = item;
                itemElement.textContent = item;
                
                // 「※」利用者以外は残り時間に基づく背景色クラスを適用
                if (item !== '※' && supportType && userRemainingTimesMap[item] && userRemainingTimesMap[item][supportType]) {
                    const remainingTime = userRemainingTimesMap[item][supportType];
                    const minutes = timeToMinutes(remainingTime);
                    const colorClass = getTimeColorClass(minutes);
                    
                    if (colorClass) {
                        itemElement.classList.add(colorClass);
                    }
                }
                
                customList.appendChild(itemElement);
                
                if (index < 3) { // 最初の3つだけログ出力
                    console.log(`🎨 カスタムドロップダウン[${index}]: ${item} (クラス: ${itemElement.className})`);
                }
            });
            
            // ボタンテキストをリセット
            customButton.textContent = '選択してください';
            
            console.log(`✅ カスタムドロップダウンの更新完了（${filteredItems.length}個のアイテム）`);
        }

        // 利用者選択用：背景色付きオプションを作成する関数
        function updateSelectOptionsWithColors(selectId, items, supportType) {
            console.log(`🎨 ${selectId} を色付きで更新中... アイテム数: ${items.length}, 支援種別: ${supportType}`);
            
            // 利用者リストをアイウエオ順にソート
            items = sortUsersByKana(items);
            
            // モバイル判定：モバイルの場合はカスタムドロップダウンを使用
            if (selectId === 'user-input' && isMobileDevice()) {
                console.log('📱 モバイル端末検出: カスタムドロップダウンを使用');
                updateCustomDropdown(items, supportType);
                return;
            }
            
            const selectElement = document.getElementById(selectId);
            
            if (!selectElement) {
                console.error(`❌ select要素が見つかりません: ${selectId}`);
                return;
            }
            
            // 既存のオプションをクリア（最初の「選択してください」オプションは保持）
            const firstOption = selectElement.querySelector('option[value=""]');
            selectElement.innerHTML = '';
            if (firstOption) {
                selectElement.appendChild(firstOption);
            } else {
                // 「選択してください」オプションがない場合は作成
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = '選択してください';
                selectElement.appendChild(defaultOption);
            }
            
            // 背景色を決定する関数
            function getBackgroundColor(minutes) {
                if (minutes <= 60) return '#ffcccc'; // 赤（1:00以下）
                if (minutes <= 120) return '#ffffcc'; // 黄（2:00以下）
                if (minutes <= 300) return '#ccffff'; // 薄い水色（5:00以下）
                return ''; // それ以上は背景色なし
            }
            
            // "-" や空白、null、undefinedを除外して追加
            const filteredItems = items.filter(item =>
                item && item.toString().trim() !== '' && item.toString().trim() !== '-'
            );
            
            filteredItems.forEach((item, index) => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                
                // 「※」利用者以外は残り時間に基づく背景色を適用
                if (item !== '※' && supportType && userRemainingTimesMap[item] && userRemainingTimesMap[item][supportType]) {
                    const remainingTime = userRemainingTimesMap[item][supportType];
                    const minutes = timeToMinutes(remainingTime);
                    const backgroundColor = getBackgroundColor(minutes);
                    
                    if (backgroundColor) {
                        option.style.backgroundColor = backgroundColor;
                        option.style.color = '#000'; // 黒文字で見やすく
                    }
                }
                
                selectElement.appendChild(option);
                if (index < 3) { // 最初の3つだけログ出力
                    console.log(`🎨 ${selectId}[${index}]: ${item} (背景色: ${option.style.backgroundColor || 'なし'})`);
                }
            });
            
            console.log(`✅ ${selectId} の色付き更新完了（${filteredItems.length}個のオプション）`);
        }

        // デフォルトデータを読み込む関数（フォールバック用）
        function loadDefaultData() {
            console.log("デフォルトデータを使用します");
            const defaultUsers = [];
            const defaultSupporters = [];
            const defaultDestinations = [];
            const defaultSupportTypes = [];
            const defaultAppearances = [];

            updateSelectOptions('user-input', defaultUsers);
            updateSelectOptions('supporter1-input', defaultSupporters);
            updateSelectOptions('supporter2-input', defaultSupporters);
            updateSelectOptions('destination-input', defaultDestinations);
            updateSelectOptions('support-type-input', defaultSupportTypes);
            updateSelectOptions('appearance-input', defaultAppearances);
            supporterSupportTypesMap = {}; // デフォルト時は空
        }

        // ページ読み込み時の初期化（高速化版）
        document.addEventListener('DOMContentLoaded', function() {
            console.log("🚀 高速初期化開始");
            
            console.log("💻 デスクトップ端末を検出");
            
            // 1. 即座に基本UI要素を初期化（日付、時間など）
            setCurrentDate();
            // setLoggedInUserName(); // データ取得完了後に実行するため削除
            setupTimeFormatting();
            setupFormSubmission();
            
            // 2. デフォルトデータを即座に読み込み（オフライン対応）
            loadDefaultData();
            
            // 3. 支援員選択イベントの設定
            document.getElementById('supporter1-input').addEventListener('change', function(e) {
                const name = e.target.value.trim();
                updateSupportTypesForSupporter(name);
            });
            
            // 4. 支援種別変更イベントの設定
            document.getElementById('support-type-input').addEventListener('change', function(e) {
                const supportType = e.target.value.trim();
                updateUserList();
                toggleNextVisitSection(supportType);
            });

            // 5. 利用者ドロップダウンのイベント設定
            setupUserDropdown();
            
            // 6. 利用者選択欄の背景色更新イベント（一度だけ設定）
            document.getElementById('user-input').addEventListener('change', function(e) {
                updateUserInputBackground(e.target.value, currentSupportType);
            });
            
            console.log("✅ 基本初期化完了 - ページ利用可能");
            
            // 4. バックグラウンドで最新データを取得（非ブロッキング）
            setTimeout(() => {
                loadDataFromGAS();
            }, 100); // 100ms後に開始（UIレンダリング優先）
        });
        
        // Google Apps Scriptから最新データを非同期取得
        async function loadDataFromGAS() {
            try {
                console.log("🔄 最新データを取得中...");
                
                // ログインユーザー名を取得
                const userName = sessionStorage.getItem('userName') || sessionStorage.getItem('userId') || '';
                console.log("📝 送信するユーザー名:", userName);
                
                const dataUrl = `https://script.google.com/macros/s/AKfycbyPoY_eSUkljZWPKh0gSy0aVUuT4r-tRyCQxJ-EavaQgqYIMeH9EcLj5AzRA-ynzOuv/exec?action=getData&userName=${encodeURIComponent(userName)}`;
                
                const response = await fetch(dataUrl);
                const responseText = await response.text();
                const data = JSON.parse(responseText);
                
                if (data.success) {
                    // 最新データでリストを更新
                    updateSelectOptions('user-input', data.users || []);
                    
                    // 支援員1: 特権ユーザーには全員表示、それ以外はログインユーザーのみ
                    const privilegedUsers = ['亀野 浩', '福澤 翔太'];
                    const supporter1List = [];
                    
                    if (userName && privilegedUsers.includes(userName)) {
                        // 特権ユーザーの場合、全支援員リストを表示
                        supporter1List.push(...(data.supporters || []));
                    } else if (userName && (data.supporters || []).includes(userName)) {
                        // 一般ユーザーの場合、ログインユーザーのみ表示
                        supporter1List.push(userName);
                    }
                    updateSelectOptions('supporter1-input', supporter1List);
                    
                    // 支援員2: 全支援員のリスト
                    updateSelectOptions('supporter2-input', data.supporters || []);
                    
                    updateSelectOptions('destination-input', data.destinations || []);
                    updateSelectOptions('support-type-input', data.supportTypes || []);
                    updateSelectOptions('appearance-input', data.appearances || []);
                    supporterSupportTypesMap = data.supporterSupportTypes || {};
                    userRemainingTimesMap = data.userRemainingTimes || {};
                    allUsers = data.users || [];
                    userFuriganaData = data.userFurigana || {};
                    
                    console.log("✅ 最新データ更新完了");
                    showUpdateNotification("📊 最新データに更新されました");
                    
                    // データ取得完了後に支援員1の自動選択を再実行
                    setTimeout(() => {
                        setLoggedInUserName();
                        // 段階的ドロップダウンでは初期表示時に特別な処理は不要
                    }, 100);
                } else {
                    console.warn("⚠️ データ取得エラー:", data.error);
                    showUpdateNotification("⚠️ データ取得に失敗しました", "warning");
                }
            } catch (error) {
                console.warn("⚠️ ネットワークエラー:", error.message);
                showUpdateNotification("📴 オフラインモードで動作中", "info");
            }
        }
        
        // 通知表示機能
        function showUpdateNotification(message, type = "success") {
            const colors = {
                success: { bg: "#10b981", icon: "✅" },
                warning: { bg: "#f59e0b", icon: "⚠️" },
                info: { bg: "#3b82f6", icon: "ℹ️" }
            };
            
            const color = colors[type] || colors.success;
            
            const notification = document.createElement('div');
            notification.innerHTML = `${color.icon} ${message}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${color.bg};
                color: white;
                padding: 12px 16px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                z-index: 1000;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s ease;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            document.body.appendChild(notification);
            
            // スライドイン
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // 3秒後にスライドアウト
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }


        // 現在の日付を設定
        function setCurrentDate() {
            const now = new Date();
            document.getElementById('year').value = now.getFullYear();
            document.getElementById('month').value = now.getMonth() + 1;
            document.getElementById('day').value = now.getDate();
        }

        // 入力された日付が今日と異なるかチェック
        function isDateDifferentFromToday(year, month, day) {
            const today = new Date();
            const inputDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
            
            return today.getFullYear() !== inputDate.getFullYear() ||
                   today.getMonth() !== inputDate.getMonth() ||
                   today.getDate() !== inputDate.getDate();
        }

        // 日付確認モーダルを表示
        function showDateConfirmModal(year, month, day, onConfirm, onCancel) {
            const modal = document.getElementById('dateConfirmModal');
            const todayDateText = document.getElementById('todayDateText');
            const inputDateText = document.getElementById('inputDateText');
            const okButton = document.getElementById('dateConfirmOk');
            const cancelButton = document.getElementById('dateConfirmCancel');
            
            // 今日の日付を表示
            const today = new Date();
            todayDateText.textContent = `${today.getFullYear()}年${today.getMonth() + 1}月${today.getDate()}日`;
            
            // 入力された日付を表示
            inputDateText.textContent = `${year}年${month}月${day}日`;
            
            // イベントリスナーをクリア
            okButton.replaceWith(okButton.cloneNode(true));
            cancelButton.replaceWith(cancelButton.cloneNode(true));
            
            // 新しいイベントリスナーを設定
            document.getElementById('dateConfirmOk').addEventListener('click', function() {
                modal.classList.add('hidden');
                onConfirm();
            });
            
            document.getElementById('dateConfirmCancel').addEventListener('click', function() {
                modal.classList.add('hidden');
                onCancel();
            });
            
            // モーダルを表示
            modal.classList.remove('hidden');
        }

        // ログインユーザーの名前を支援員1欄に設定
        function setLoggedInUserName() {
            try {
                const userName = sessionStorage.getItem('userName');
                const userId = sessionStorage.getItem('userId');
                
                console.log('🔍 ログイン情報確認:', { userName, userId });
                
                const supporter1Select = document.getElementById('supporter1-input');
                if (!supporter1Select) {
                    console.error('❌ 支援員1の選択欄が見つかりません');
                    return;
                }
                
                // 利用可能なオプションをログ出力
                console.log('📋 支援員1の利用可能オプション:', 
                    Array.from(supporter1Select.options).map(opt => `"${opt.value}"`));
                
                if (userName) {
                    // selectのoptionから該当する値を探して設定
                    const option = Array.from(supporter1Select.options).find(opt => opt.value === userName);
                    if (option) {
                        supporter1Select.value = userName;
                        console.log(`✅ 支援員1に自動選択: ${userName}`);
                        
                        // 支援種別の更新をトリガー
                        updateSupportTypesForSupporter(userName);
                    } else {
                        console.warn(`⚠️ 支援員リストに「${userName}」が見つかりません`);
                        console.warn('利用可能な選択肢:', Array.from(supporter1Select.options).map(opt => opt.value));
                    }
                } else if (userId) {
                    // selectのoptionから該当する値を探して設定
                    const option = Array.from(supporter1Select.options).find(opt => opt.value === userId);
                    if (option) {
                        supporter1Select.value = userId;
                        console.log(`✅ 支援員1に自動選択（ID使用）: ${userId}`);
                        
                        // 支援種別の更新をトリガー
                        updateSupportTypesForSupporter(userId);
                    } else {
                        console.warn(`⚠️ 支援員リストに「${userId}」が見つかりません`);
                        console.warn('利用可能な選択肢:', Array.from(supporter1Select.options).map(opt => opt.value));
                    }
                } else {
                    console.warn('⚠️ ログインユーザー情報が見つかりません。index.htmlからアクセスしてください。');
                }
            } catch (error) {
                console.error('❌ ログインユーザー名の設定エラー:', error);
            }
        }

        // 指定された支援員名に基づいて支援種別を更新
        function updateSupportTypesForSupporter(supporterName) {
            try {
                const name = supporterName.trim();
                let types = supporterSupportTypesMap[name];
                
                if (!types || types.length === 0) {
                    // デフォルトの支援種別
                    types = ["移動支援", "行動援護", "通院等介助"];
                    console.log(`⚠️ ${name}の支援種別データが見つかりません。デフォルトを使用します。`);
                } else {
                    console.log(`✅ ${name}の支援種別を更新:`, types);
                }
                
                updateSelectOptions('support-type-input', types);
            } catch (error) {
                console.error('❌ 支援種別更新エラー:', error);
            }
        }

        // 支援種別に基づいて利用者リストを更新する関数（後方互換性のため）
        function updateUserListBySupportType(supportType) {
            updateUserList();
        }

        // 次回通院日セクションの表示/非表示を切り替える関数
        function toggleNextVisitSection(supportType) {
            const nextVisitSection = document.getElementById('next-visit-section');
            if (supportType === '通院等介助') {
                nextVisitSection.style.display = 'block';
                console.log('✅ 次回通院日セクションを表示しました');
            } else {
                nextVisitSection.style.display = 'none';
                // 非表示時は入力値をクリア
                document.getElementById('next-visit-date-input').value = '';
                document.getElementById('next-visit-time-input').value = '';
                document.getElementById('hospital-name-input').value = '';
                console.log('🔒 次回通院日セクションを非表示にしました');
            }
        }

        // 段階的ドロップダウンセットアップ
        function setupUserDropdown() {
            const dropdownButton = document.getElementById('user-dropdown-button');
            const kanaSelection = document.getElementById('kana-selection');
            const userListView = document.getElementById('user-list-view');
            const backButton = document.getElementById('back-to-kana');
            
            // 状態1: 初期表示 → 状態2: 50音選択画面
            dropdownButton.addEventListener('click', function() {
                hideAllMenus();
                kanaSelection.classList.remove('hidden');
                console.log('50音選択画面を表示');
            });
            
            // 状態2: 50音選択 → 状態3: 利用者一覧画面
            document.querySelectorAll('.dropdown-option').forEach(option => {
                option.addEventListener('click', function() {
                    const selectedKana = this.getAttribute('data-kana');
                    console.log(`50音「${selectedKana || '全て'}」が選択されました`);
                    
                    // 利用者一覧を更新して表示
                    updateUserOptionsAndShow(selectedKana);
                });
            });
            
            // 状態3: 戻るボタン → 状態2: 50音選択画面
            backButton.addEventListener('click', function() {
                hideAllMenus();
                kanaSelection.classList.remove('hidden');
                console.log('50音選択画面に戻りました');
            });
            
            // 外部クリックでメニューを閉じる
            document.addEventListener('click', function(event) {
                const dropdown = document.getElementById('user-dropdown');
                if (!dropdown.contains(event.target)) {
                    hideAllMenus();
                }
            });
        }
        
        // すべてのドロップダウンメニューを非表示にする
        function hideAllMenus() {
            document.getElementById('kana-selection').classList.add('hidden');
            document.getElementById('user-list-view').classList.add('hidden');
        }
        
        // 利用者オプションを更新して利用者一覧画面を表示
        function updateUserOptionsAndShow(selectedKana) {
            const supportType = document.getElementById('support-type-input').value;
            const userOptionsContainer = document.getElementById('user-options');
            
            // フィルタリングされた利用者リストを取得
            const filteredUsers = getFilteredUsers(selectedKana, supportType);
            
            // 利用者オプションを生成
            userOptionsContainer.innerHTML = '';
            
            filteredUsers.forEach(userName => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'user-option';
                button.textContent = userName;
                button.dataset.userName = userName;
                
                // 残り時間による色分け
                if (userName !== '※' && supportType && userRemainingTimesMap[userName] && userRemainingTimesMap[userName][supportType]) {
                    const remainingTime = userRemainingTimesMap[userName][supportType];
                    const minutes = timeToMinutes(remainingTime);
                    
                    if (minutes <= 60) {
                        button.classList.add('time-red');
                    } else if (minutes <= 120) {
                        button.classList.add('time-yellow');
                    } else if (minutes <= 300) {
                        button.classList.add('time-cyan');
                    }
                }
                
                // クリックイベント
                button.addEventListener('click', function() {
                    // 利用者を選択して状態1に戻る
                    selectUser(userName, supportType);
                });
                
                userOptionsContainer.appendChild(button);
            });
            
            // 利用者一覧画面を表示
            hideAllMenus();
            document.getElementById('user-list-view').classList.remove('hidden');
            
            console.log(`${filteredUsers.length}名の利用者を表示しました`);
        }
        
        // 利用者を選択して初期状態に戻る
        function selectUser(userName, supportType) {
            // 隠し入力フィールドに値を設定
            document.getElementById('user-input').value = userName;
            
            // ドロップダウンボタンのテキストを更新
            document.getElementById('user-dropdown-button').textContent = `${userName} ▼`;
            
            // すべてのメニューを非表示
            hideAllMenus();
            
            // 背景色を更新
            updateUserInputBackground(userName, supportType);
            
            console.log(`利用者「${userName}」が選択されました`);
        }

        // フィルタリングされた利用者を取得する関数
        function getFilteredUsers(selectedKana, supportType) {
            const filteredUsers = [];
            
            allUsers.forEach(userName => {
                if (!userName || userName.trim() === '') return;
                
                // 「※」利用者は常に表示（残り時間データに関係なく）
                if (userName === '※') {
                    filteredUsers.push(userName);
                    return;
                }
                
                // 50音によるフィルタリング
                if (selectedKana) {
                    const furigana = userFuriganaData[userName];
                    if (!furigana) {
                        console.log(`利用者「${userName}」: フリガナデータがないため除外`);
                        return;
                    }
                    
                    const firstChar = furigana.charAt(0);
                    const kanaGroup = getInitialGroup(firstChar);
                    
                    if (kanaGroup !== selectedKana) {
                        return;
                    }
                }
                
                // 支援種別によるフィルタリング
                if (supportType) {
                    const userTimes = userRemainingTimesMap[userName];
                    
                    if (!userTimes) {
                        return;
                    }
                    
                    const remainingTime = userTimes[supportType];
                    
                    if (!remainingTime || remainingTime === '') {
                        return;
                    }
                    
                    const minutes = timeToMinutes(remainingTime);
                    
                    if (minutes <= 0) {
                        return;
                    }
                }
                
                filteredUsers.push(userName);
            });
            
            return sortUsersByKana(filteredUsers);
        }

        // 支援種別変更時の処理（段階的ドロップダウンでは特別な処理は不要）
        function updateUserList() {
            // 段階的ドロップダウンでは、利用者がすでに選択されている場合は何もしない
            // 新たに50音を選択した時点で最新のフィルタリングが適用される
            console.log('支援種別が変更されました - 利用者を再選択する必要があります');
        }
        
        // 利用者をフリガナのアイウエオ順でソートする関数
        function sortUsersByKana(users) {
            // 「※」は常に最初に表示
            const asteriskUsers = users.filter(user => user === '※');
            const normalUsers = users.filter(user => user !== '※');
            
            // フリガナデータを使ってソート
            normalUsers.sort((a, b) => {
                const furiganaA = userFuriganaData[a] || a; // フリガナがない場合は元の名前を使用
                const furiganaB = userFuriganaData[b] || b;
                
                // ひらがな・カタカナでソート
                return furiganaA.localeCompare(furiganaB, 'ja');
            });
            
            // 「※」を先頭に、その後ソート済みの利用者
            return [...asteriskUsers, ...normalUsers];
        }
        
        // フリガナから頭文字グループを判定する関数
        function getInitialGroup(firstChar) {
            if (!firstChar) return '';
            
            const kanaMap = {
                'あ': ['あ', 'い', 'う', 'え', 'お', 'ア', 'イ', 'ウ', 'エ', 'オ'],
                'か': ['か', 'き', 'く', 'け', 'こ', 'が', 'ぎ', 'ぐ', 'げ', 'ご', 'カ', 'キ', 'ク', 'ケ', 'コ', 'ガ', 'ギ', 'グ', 'ゲ', 'ゴ'],
                'さ': ['さ', 'し', 'す', 'せ', 'そ', 'ざ', 'じ', 'ず', 'ぜ', 'ぞ', 'サ', 'シ', 'ス', 'セ', 'ソ', 'ザ', 'ジ', 'ズ', 'ゼ', 'ゾ'],
                'た': ['た', 'ち', 'つ', 'て', 'と', 'だ', 'ぢ', 'づ', 'で', 'ど', 'タ', 'チ', 'ツ', 'テ', 'ト', 'ダ', 'ヂ', 'ヅ', 'デ', 'ド'],
                'な': ['な', 'に', 'ぬ', 'ね', 'の', 'ナ', 'ニ', 'ヌ', 'ネ', 'ノ'],
                'は': ['は', 'ひ', 'ふ', 'へ', 'ほ', 'ば', 'び', 'ぶ', 'べ', 'ぼ', 'ぱ', 'ぴ', 'ぷ', 'ぺ', 'ぽ', 'ハ', 'ヒ', 'フ', 'ヘ', 'ホ', 'バ', 'ビ', 'ブ', 'ベ', 'ボ', 'パ', 'ピ', 'プ', 'ペ', 'ポ'],
                'ま': ['ま', 'み', 'む', 'め', 'も', 'マ', 'ミ', 'ム', 'メ', 'モ'],
                'や': ['や', 'ゆ', 'よ', 'ヤ', 'ユ', 'ヨ'],
                'ら': ['ら', 'り', 'る', 'れ', 'ろ', 'ラ', 'リ', 'ル', 'レ', 'ロ'],
                'わ': ['わ', 'を', 'ん', 'ワ', 'ヲ', 'ン']
            };
            
            for (const [group, chars] of Object.entries(kanaMap)) {
                if (chars.includes(firstChar)) {
                    return group;
                }
            }
            
            return '';
        }
        
        // 時間を分に変換するヘルパー関数
        function timeToMinutes(timeStr) {
            console.log(`🔍 timeToMinutes呼び出し: "${timeStr}" (型: ${typeof timeStr})`);
            
            if (!timeStr || typeof timeStr !== 'string') {
                console.log(`❌ 無効な入力: ${timeStr}`);
                return 0;
            }
            
            
            // ISO日付形式の場合（例: "1899-12-30T06:00:00.000Z"）
            if (timeStr.includes('T') && timeStr.includes('Z')) {
                try {
                    const date = new Date(timeStr);
                    console.log(`📅 ISO日付として解析: ${date.toISOString()}`);
                    
                    // 1899年基準の日付の場合
                    if (date.getUTCFullYear() === 1899 || date.getUTCFullYear() === 1900) {
                        // スプレッドシートで時間データ(HH:MM)がISO日付に変換される際、
                        // 1899-12-30が基準日として使われ、時刻部分に実際の時間が入る場合と
                        // 基準日からの経過時間として日付部分に加算される場合がある
                        
                        const year = date.getUTCFullYear();
                        const month = date.getUTCMonth(); // 0ベース（12月=11）
                        const day = date.getUTCDate();
                        const hours = date.getUTCHours();
                        const minutes = date.getUTCMinutes();
                        
                        console.log(`📊 日付詳細: ${year}-${month+1}-${day} ${hours}:${minutes}`);
                        
                        // 基準日（1899-12-30）と同じ日付の場合の特別処理
                        if (year === 1899 && month === 11 && day === 30) {
                            // 時刻部分がゼロの場合、これは時間データの変換問題の可能性がある
                            if (hours === 0 && minutes === 0) {
                                console.log(`⚠️ 基準日で時刻が00:00 - データ変換問題の可能性`);
                                // この場合、元のデータが何時間だったかを推測する必要がある
                                // ただし、実際に0時間の場合もあるため、0を返す
                                return 0;
                            }
                            
                            const totalMinutes = hours * 60 + minutes;
                            console.log(`⏰ 同日の時刻として計算: ${hours}時間${minutes}分 = ${totalMinutes}分`);
                            return totalMinutes;
                        }
                        
                        // Excelの日付システムを考慮した処理
                        // 1899年システムでは、時間のみのデータは日付部分に反映される場合がある
                        
                        // 1900-01-01の場合、時刻部分が実際の時間データを表す
                        if (year === 1900 && month === 0 && day === 1) {
                            const totalMinutes = hours * 60 + minutes;
                            console.log(`🎯 1900-01-01の時刻データとして処理: ${hours}時間${minutes}分 = ${totalMinutes}分`);
                            return totalMinutes;
                        }
                        
                        // 基準日からの経過時間を計算（1899-12-29などの場合）
                        // ただし、負の値になる場合は、24時間を加算して再計算
                        const baseDate = new Date('1899-12-30T00:00:00.000Z');
                        let diffMs = date.getTime() - baseDate.getTime();
                        let diffMinutes = Math.floor(diffMs / (1000 * 60));
                        
                        console.log(`📈 基準日からの経過時間: ${diffMinutes}分`);
                        
                        return Math.max(0, diffMinutes);
                    }
                    
                    // 通常の日付の場合、時刻部分のみを使用
                    const hours = date.getUTCHours();
                    const minutes = date.getUTCMinutes();
                    const totalMinutes = hours * 60 + minutes;
                    console.log(`🕐 通常の時刻計算: ${hours}時間${minutes}分 = ${totalMinutes}分`);
                    return totalMinutes;
                } catch (error) {
                    console.error('❌ ISO日付の解析エラー:', error, timeStr);
                    return 0;
                }
            }
            
            // HH:MM形式の場合
            const parts = timeStr.split(':');
            if (parts.length !== 2) {
                console.log(`❌ HH:MM形式ではない: ${timeStr}`);
                return 0;
            }
            const hours = parseInt(parts[0]) || 0;
            const minutes = parseInt(parts[1]) || 0;
            const totalMinutes = hours * 60 + minutes;
            console.log(`🕐 HH:MM形式として計算: ${hours}時間${minutes}分 = ${totalMinutes}分`);
            return totalMinutes;
        }
        
        // 利用者入力欄の背景色を更新する関数
        function updateUserInputBackground(userName, supportType) {
            const userInput = document.getElementById('user-input');
            
            if (!userName || !supportType || !userRemainingTimesMap[userName]) {
                userInput.style.backgroundColor = '';
                return;
            }
            
            const remainingTime = userRemainingTimesMap[userName][supportType];
            if (!remainingTime) {
                userInput.style.backgroundColor = '';
                return;
            }
            
            
            const minutes = timeToMinutes(remainingTime);
            
            // 背景色を設定
            if (minutes <= 60) {
                userInput.style.backgroundColor = '#ffcccc'; // 赤
            } else if (minutes <= 120) {
                userInput.style.backgroundColor = '#ffffcc'; // 黄
            } else if (minutes <= 300) {
                userInput.style.backgroundColor = '#ccffff'; // 薄い水色
            } else {
                userInput.style.backgroundColor = '';
            }
        }

        // 時間フォーマット設定
        function setupTimeFormatting() {
            function formatTime(event) {
                console.log("formatTime called for:", event.target.id);
                const inputElement = event.target;
                let value = inputElement.value.replace(/[^0-9]/g, '');

                if (value === '') {
                    inputElement.value = '';
                    return;
                }

                let hour, minute;

                if (value.length <= 2) {
                    hour = parseInt(value, 10);
                    minute = 0;
                } else {
                    minute = parseInt(value.slice(-2), 10);
                    hour = parseInt(value.slice(0, -2), 10);
                }

                hour = isNaN(hour) ? 0 : hour;
                minute = isNaN(minute) ? 0 : minute;

                if (hour > 23) {
                    hour = 23;
                }
                if (minute > 59) {
                    minute = 59;
                }

                const formattedHour = hour.toString();
                const formattedMinute = minute.toString().padStart(2, '0');
                inputElement.value = `${formattedHour}:${formattedMinute}`;
            }

            document.getElementById('start-time').addEventListener('blur', formatTime);
            document.getElementById('end-time').addEventListener('blur', formatTime);
        }

        // フォーム送信設定
        function setupFormSubmission() {
            document.getElementById('recordForm').addEventListener('submit', function(event) {
                event.preventDefault(); // デフォルトの送信を防ぐ
                
                // 各フィールドの値を取得
                const year = document.getElementById('year').value;
                const month = document.getElementById('month').value;
                const day = document.getElementById('day').value;
                const startTime = document.getElementById('start-time').value;
                const endTime = document.getElementById('end-time').value;
                const user = document.getElementById('user-input').value;
                const supporter1 = document.getElementById('supporter1-input').value;
                const supporter2 = document.getElementById('supporter2-input').value;
                const destination = document.getElementById('destination-input').value;
                const supportType = document.getElementById('support-type-input').value;
                const appearance = document.getElementById('appearance-input').value;
                const userCheck = document.getElementById('check1').checked ? 'はい' : 'いいえ';
                const nextVisitDate = document.getElementById('next-visit-date-input').value;
                const nextVisitTime = document.getElementById('next-visit-time-input').value;
                const hospitalName = document.getElementById('hospital-name-input').value;

                // フォームデータをオブジェクトとして作成
                const formData = {
                    year, month, day, startTime, endTime,
                    user, supporter1, supporter2, destination,
                    supportType, userCheck, appearance,
                    nextVisitDate, nextVisitTime, hospitalName
                };
                
                // 日付確認フローを開始
                checkDateAndProceed(formData);
            });
        }

        // 日付確認フローの実行
        function checkDateAndProceed(formData) {
            // 日付が今日と異なるかチェック
            if (isDateDifferentFromToday(formData.year, formData.month, formData.day)) {
                // 今日と異なる場合：日付確認モーダルを表示
                showDateConfirmModal(
                    formData.year, 
                    formData.month, 
                    formData.day,
                    function() { // OK: 内容確認に進む
                        showContentConfirmation(formData);
                    },
                    function() { // キャンセル: 何もしない
                        console.log('日付確認がキャンセルされました');
                    }
                );
            } else {
                // 今日と同じ場合：直接内容確認に進む
                showContentConfirmation(formData);
            }
        }

        // 内容確認画面を表示
        function showContentConfirmation(formData) {
            // 次回通院日情報を追加（通院等介助の場合のみ）
            let nextVisitInfo = '';
            if (formData.supportType === '通院等介助' && (formData.nextVisitDate || formData.nextVisitTime || formData.hospitalName)) {
                nextVisitInfo = `\n📅 次回通院日: ${formData.nextVisitDate || '未入力'}`;
                nextVisitInfo += `\n⏰ 次回通院時刻: ${formData.nextVisitTime || '未入力'}`;
                nextVisitInfo += `\n🏥 病院名: ${formData.hospitalName || '未入力'}`;
            }

            // 確認メッセージを作成
            const confirmMessage = `以下の内容で送信してよろしいですか？

📅 日付: ${formData.year}年${formData.month}月${formData.day}日
⏰ 時間: ${formData.startTime} ～ ${formData.endTime}
👤 利用者: ${formData.user}
👥 支援員1: ${formData.supporter1}
👥 支援員2: ${formData.supporter2}
📍 行き先: ${formData.destination}
🏷️ 支援種別: ${formData.supportType}
😊 様子: ${formData.appearance}
✅ 利用者様確認: ${formData.userCheck}${nextVisitInfo}`;

            if (confirm(confirmMessage)) {
                // 送信実行
                submitFormData(formData);
            }
        }
        
        // モーダルを表示する関数
        function showModal(isSuccess, message, formData) {
            const modal = document.getElementById('submitModal');
            const modalMessage = modal.querySelector('.modal-message');
            const successIcon = modal.querySelector('.success-icon');
            const modalDataContent = document.getElementById('modalDataContent');
            
            // メッセージとアイコンを設定
            modalMessage.textContent = message;
            if (isSuccess) {
                successIcon.textContent = '✅';
                successIcon.style.color = '#10b981';
            } else {
                successIcon.textContent = '❌';
                successIcon.style.color = '#dc2626';
            }
            
            // 送信データをテーブルに表示
            modalDataContent.innerHTML = '';
            if (isSuccess && formData) {
                const dataRows = [
                    { label: '日付', value: `${formData.year}年${formData.month}月${formData.day}日` },
                    { label: '時間', value: `${formData.startTime} ～ ${formData.endTime}` },
                    { label: '利用者', value: formData.user },
                    { label: '支援員1', value: formData.supporter1 },
                    { label: '支援員2', value: formData.supporter2 || 'なし' },
                    { label: '行き先', value: formData.destination },
                    { label: '支援種別', value: formData.supportType },
                    { label: '様子', value: formData.appearance },
                    { label: '利用者確認', value: formData.userCheck === 'はい' ? '確認済み' : '未確認' }
                ];

                // 次回通院日情報を追加（通院等介助で入力がある場合のみ）
                if (formData.supportType === '通院等介助' && (formData.nextVisitDate || formData.nextVisitTime || formData.hospitalName)) {
                    if (formData.nextVisitDate) {
                        dataRows.push({ label: '次回通院日', value: formData.nextVisitDate });
                    }
                    if (formData.nextVisitTime) {
                        dataRows.push({ label: '次回通院時刻', value: formData.nextVisitTime });
                    }
                    if (formData.hospitalName) {
                        dataRows.push({ label: '病院名', value: formData.hospitalName });
                    }
                }

                dataRows.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <th>${row.label}</th>
                        <td>${row.value}</td>
                    `;
                    modalDataContent.appendChild(tr);
                });
            }
            
            // モーダルを表示
            modal.classList.remove('hidden');
            
            // 閉じるボタンにフォーカス
            setTimeout(() => {
                modal.querySelector('.modal-button').focus();
            }, 100);
        }
        
        // モーダルを閉じる関数
        function closeModal() {
            const modal = document.getElementById('submitModal');
            modal.classList.add('hidden');
        }
        
        // ESCキーでモーダルを閉じる
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
        
        // オーバーレイクリックでモーダルを閉じる
        document.addEventListener('DOMContentLoaded', function() {
            const modalOverlay = document.getElementById('submitModal');
            modalOverlay.addEventListener('click', function(e) {
                if (e.target === modalOverlay) {
                    closeModal();
                }
            });
        });

        // 送信ボタンの状態を管理する関数
        function setSubmitButtonState(isLoading) {
            const submitButton = document.querySelector('.submit-button');
            if (isLoading) {
                submitButton.disabled = true;
                submitButton.innerHTML = '送信中... <span style="animation: spin 1s linear infinite; display: inline-block;">⏳</span>';
                submitButton.style.opacity = '0.7';
                submitButton.style.cursor = 'not-allowed';
            } else {
                submitButton.disabled = false;
                submitButton.innerHTML = '記録を送信';
                submitButton.style.opacity = '1';
                submitButton.style.cursor = 'pointer';
            }
        }

        // フォームデータをAJAXで送信
        async function submitFormData(formData) {
            try {
                console.log('=== フォーム送信開始 ===');
                console.log('送信データ:', formData);
                
                // 送信中状態に変更
                setSubmitButtonState(true);
                
                // FormDataを作成
                const formDataObj = new FormData();
                Object.keys(formData).forEach(key => {
                    formDataObj.append(key, formData[key]);
                    console.log(`FormData追加: ${key} = ${formData[key]}`);
                });
                
                const submitUrl = 'https://script.google.com/macros/s/AKfycbyPoY_eSUkljZWPKh0gSy0aVUuT4r-tRyCQxJ-EavaQgqYIMeH9EcLj5AzRA-ynzOuv/exec';
                console.log('送信URL:', submitUrl);
                
                const response = await fetch(submitUrl, {
                    method: 'POST',
                    body: formDataObj
                });
                
                console.log('レスポンスステータス:', response.status);
                console.log('レスポンスヘッダー:', response.headers);
                
                const result = await response.text();
                console.log('送信結果（生テキスト）:', result);
                
                try {
                    const jsonResult = JSON.parse(result);
                    console.log('送信結果（JSON）:', jsonResult);
                    
                    if (jsonResult.success) {
                        // 成功モーダルを表示
                        showModal(true, jsonResult.message || '記録が正常に送信されました', formData);
                        
                        // フォームをリセット
                        document.getElementById('recordForm').reset();
                        setCurrentDate(); // 日付を再設定
                        
                        // selectフィールドを「選択してください」にリセット
                        document.getElementById('supporter1-input').value = '';
                        document.getElementById('supporter2-input').value = '';
                        document.getElementById('support-type-input').value = '';
                        document.getElementById('user-input').value = '';
                        document.getElementById('destination-input').value = '';
                        document.getElementById('appearance-input').value = '';
                        
                        // 利用者ドロップダウンを初期状態にリセット
                        document.getElementById('user-dropdown-button').textContent = '選択してください ▼';
                        hideAllMenus();
                        
                        
                        // 少し遅れて支援員名を再設定（selectのoptionが準備されてから）
                        setTimeout(() => {
                            setLoggedInUserName();
                        }, 100);
                    } else {
                        // エラーモーダルを表示
                        showModal(false, `エラー: ${jsonResult.error}`, null);
                    }
                } catch (parseError) {
                    console.error('JSONパースエラー:', parseError);
                    console.error('パース対象テキスト:', result);
                    // JSONパースエラーモーダルを表示
                    showModal(false, 'サーバーからの応答を解析できませんでしたが、送信は完了した可能性があります。', formData);
                }
                
            } catch (error) {
                console.error('送信エラー:', error);
                showModal(false, `送信に失敗しました: ${error.message}`, null);
            } finally {
                // 送信完了後は必ずボタンを元に戻す
                setSubmitButtonState(false);
            }
        }

        // 空白行を非表示にする関数
        function hideEmptyRows(sheet, startRow, endRow) {
          const hiddenRows = [];
          
          try {
            console.log(`空白行チェック: ${startRow}行目～${endRow}行目`);
            
            // 各行をチェック
            for (let row = startRow; row <= endRow; row++) {
              // A列の値を取得
              const valueA = sheet.getRange(row, 1).getValue();
              
              // A列が空白または空文字の場合
              if (!valueA || valueA.toString().trim() === '') {
                // 行を非表示にする
                sheet.hideRows(row, 1);
                hiddenRows.push(row);
              }
            }
            
            console.log(`非表示にした行: ${hiddenRows.length}行`);
            return hiddenRows;
            
          } catch (error) {
            console.error('空白行非表示エラー:', error);
            return hiddenRows;
          }
        }

        // Admin menu
        document.addEventListener('DOMContentLoaded', function() {
            const userRole = sessionStorage.getItem('userRole');
            if (userRole === 'admin') {
                const adminMenu = document.getElementById('admin-menu');
                const button = document.createElement('button');
                button.textContent = 'ユーザー管理';
                button.className = 'admin-button';
                button.onclick = function() {
                    window.location.href = 'admin.html';
                };
                adminMenu.appendChild(button);
            }
        });
    </script>
    
    <!-- 日付確認モーダル -->
    <div id="dateConfirmModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">日付確認</h2>
            </div>
            <div class="modal-body">
                <div class="warning-icon">⚠️</div>
                <p class="modal-message">
                    入力された日付が今日と異なります。<br>
                    このまま送信してもよろしいですか？
                </p>
                <div class="date-info">
                    <div class="date-comparison">
                        <div class="today-date">
                            <span class="date-label">今日：</span>
                            <span id="todayDateText"></span>
                        </div>
                        <div class="input-date">
                            <span class="date-label">入力日：</span>
                            <span id="inputDateText"></span>
                        </div>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="dateConfirmOk" class="btn-ok">OK（送信続行）</button>
                    <button id="dateConfirmCancel" class="btn-cancel">キャンセル</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 送信完了モーダル -->
    <div id="submitModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">送信完了</h2>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="success-icon">✅</div>
                <p class="modal-message">記録が正常に送信されました</p>
                <div class="submitted-data">
                    <h3>送信内容</h3>
                    <table class="data-table">
                        <tbody id="modalDataContent">
                            <!-- 動的に生成されます -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-button" onclick="closeModal()">閉じる</button>
            </div>
        </div>
    </div>
</body></html>